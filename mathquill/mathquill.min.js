!function(){var t=window.jQuery,e="mathquill-block-id",n=Math.min,i=Math.max;if(!t)throw"MathQuill requires jQuery 1.5.2+ to be loaded first";function r(){}var s=[].slice;function o(t){var e=t.length-1;return function(){var n=s.call(arguments,0,e),i=s.call(arguments,e);return t.apply(this,n.concat([i]))}}var a=o((function(t,e){return o((function(n,i){if(t in n)return n[t].apply(n,e.concat(i))}))}));function l(t){return o((function(e,n){"function"!=typeof e&&(e=a(e));return t.call(this,(function(t){return e.apply(t,[t].concat(n))}))}))}function c(t){var e=s.call(arguments,1);return function(){return t.apply(this,e)}}function h(t,e){if(!e)throw new Error("prayer failed: "+t)}var u=function(t,e,n){function i(t){return"object"==typeof t}function r(t){return"function"==typeof t}function s(){}return function t(n,o){function a(){var t=new l;return r(t.init)&&t.init.apply(t,arguments),t}function l(){}void 0===o&&(o=n,n=Object),a.Bare=l;var c,h=s.prototype=n.prototype,u=l.prototype=a.prototype=a.p=new s;return u.constructor=a,a.extend=function(e){return t(a,e)},(a.open=function(t){if(c={},r(t)?c=t.call(a,u,h,a,n):i(t)&&(c=t),i(c))for(var s in c)e.call(c,s)&&(u[s]=c[s]);return r(u.init)||(u.init=n),a})(o)}}(0,{}.hasOwnProperty),f=-1;function p(t){h("a direction was passed",t===f||1===t)}var d=u(t,(function(t){t.insDirOf=function(t,e){return t===f?this.insertBefore(e.first()):this.insertAfter(e.last())},t.insAtDirEnd=function(t,e){return t===f?this.prependTo(e):this.appendTo(e)}})),m=u((function(t){t.parent=0,t[f]=0,t[1]=0,t.init=function(t,e,n){this.parent=t,this[f]=e,this[1]=n},this.copy=function(t){return m(t.parent,t[f],t[1])}})),g=u((function(t){t[f]=0,t[1]=0,t.parent=0;var e=0;this.byId={},t.init=function(){this.id=e+=1,g.byId[this.id]=this,this.ends={},this.ends[f]=0,this.ends[1]=0},t.dispose=function(){delete g.byId[this.id]},t.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},t.jQ=d(),t.jQadd=function(t){return this.jQ=this.jQ.add(t)},t.jQize=function(t){t=d(t||this.html());function e(t){if(t.getAttribute){var n=t.getAttribute("mathquill-command-id"),i=t.getAttribute("mathquill-block-id");n&&g.byId[n].jQadd(t),i&&g.byId[i].jQadd(t)}for(t=t.firstChild;t;t=t.nextSibling)e(t)}for(var n=0;n<t.length;n+=1)e(t[n]);return t},t.createDir=function(t,e){p(t);return this.jQize(),this.jQ.insDirOf(t,e.jQ),e[t]=this.adopt(e.parent,e[f],e[1]),this},t.createLeftOf=function(t){return this.createDir(f,t)},t.selectChildren=function(t,e){return y(t,e)},t.bubble=l((function(t){for(var e=this;e;e=e.parent){if(!1===t(e))break}return this})),t.postOrder=l((function(t){return function e(n){n.eachChild(e),t(n)}(this),this})),t.isEmpty=function(){return 0===this.ends[f]&&0===this.ends[1]},t.isStyleBlock=function(){return!1},t.children=function(){return b(this.ends[f],this.ends[1])},t.eachChild=function(){var t=this.children();return t.each.apply(t,arguments),this},t.foldChildren=function(t,e){return this.children().fold(t,e)},t.withDirAdopt=function(t,e,n,i){return b(this,this).withDirAdopt(t,e,n,i),this},t.adopt=function(t,e,n){return b(this,this).adopt(t,e,n),this},t.disown=function(){return b(this,this).disown(),this},t.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}));function v(t,e,n){h("a parent is always present",t),h("leftward is properly set up",e?e[1]===n&&e.parent===t:t.ends[f]===n),h("rightward is properly set up",n?n[f]===e&&n.parent===t:t.ends[1]===e)}var b=u((function(t){t.init=function(t,e,n){if(void 0===n&&(n=f),p(n),h("no half-empty fragments",!t==!e),this.ends={},t){h("withDir is passed to Fragment",t instanceof g),h("oppDir is passed to Fragment",e instanceof g),h("withDir and oppDir have the same parent",t.parent===e.parent),this.ends[n]=t,this.ends[-n]=e;var i=this.fold([],(function(t,e){return t.push.apply(t,e.jQ.get()),t}));this.jQ=this.jQ.add(i)}},t.jQ=d(),t.withDirAdopt=function(t,e,n,i){return t===f?this.adopt(e,n,i):this.adopt(e,i,n)},t.adopt=function(t,e,n){v(t,e,n);this.disowned=!1;var i=this.ends[f];if(!i)return this;var r=this.ends[1];return e||(t.ends[f]=i),n?n[f]=r:t.ends[1]=r,this.ends[1][1]=n,this.each((function(n){n[f]=e,n.parent=t,e&&(e[1]=n),e=n})),this},t.disown=function(){var t=this.ends[f];if(!t||this.disowned)return this;this.disowned=!0;var e=this.ends[1],n=t.parent;return v(n,t[f],t),v(n,e,e[1]),t[f]?t[f][1]=e[1]:n.ends[f]=e[1],e[1]?e[1][f]=t[f]:n.ends[1]=t[f],this},t.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},t.each=l((function(t){var e=this.ends[f];if(!e)return this;for(;e!==this.ends[1][1];e=e[1]){if(!1===t(e))break}return this})),t.fold=function(t,e){return this.each((function(n){t=e.call(this,t,n)})),t}})),w={},x={},q=u(m,(function(t){t.init=function(t,e){this.parent=t,this.options=e;var n=this.jQ=this._jQ=d('<span class="mq-cursor">&#8203;</span>');this.blink=function(){n.toggleClass("mq-blink")},this.upDownCache={}},t.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[1]?this.selection&&this.selection.ends[f][f]===this[f]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[1].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},t.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=d(),this},t.withDirInsertAt=function(t,e,n,i){var r=this.parent;this.parent=e,this[t]=n,this[-t]=i,r!==e&&r.blur&&r.blur(this)},t.insDirOf=function(t,e){return p(t),this.jQ.insDirOf(t,e.jQ),this.withDirInsertAt(t,e.parent,e[t],e),this.parent.jQ.addClass("mq-hasCursor"),this},t.insLeftOf=function(t){return this.insDirOf(f,t)},t.insRightOf=function(t){return this.insDirOf(1,t)},t.insAtDirEnd=function(t,e){return p(t),this.jQ.insAtDirEnd(t,e.jQ),this.withDirInsertAt(t,e,0,e.ends[t]),e.focus(),this},t.insAtLeftEnd=function(t){return this.insAtDirEnd(f,t)},t.insAtRightEnd=function(t){return this.insAtDirEnd(1,t)},t.jumpUpDown=function(t,e){this.upDownCache[t.id]=m.copy(this);var n=this.upDownCache[e.id];if(n)n[1]?this.insLeftOf(n[1]):this.insAtRightEnd(n.parent);else{var i=this.offset().left;e.seek(i,this)}},t.offset=function(){var t=this.jQ.removeClass("mq-cursor").offset();return this.jQ.addClass("mq-cursor"),t},t.unwrapGramp=function(){var t=this.parent.parent,e=t.parent,n=t[1],i=t[f];if(t.disown().eachChild((function(r){r.isEmpty()||(r.children().adopt(e,i,n).each((function(e){e.jQ.insertBefore(t.jQ.first())})),i=r.ends[1])})),!this[1])if(this[f])this[1]=this[f][1];else for(;!this[1];){if(this.parent=this.parent[1],!this.parent){this[1]=t[1],this.parent=e;break}this[1]=this.parent.ends[f]}this[1]?this.insLeftOf(this[1]):this.insAtRightEnd(e),t.jQ.remove(),t[f].siblingDeleted&&t[f].siblingDeleted(this.options,1),t[1].siblingDeleted&&t[1].siblingDeleted(this.options,f)},t.startSelection=function(){for(var t=this.anticursor=m.copy(this),e=t.ancestors={},n=t;n.parent;n=n.parent)e[n.parent.id]=n},t.endSelection=function(){delete this.anticursor},t.select=function(){var t=this.anticursor;if(this[f]===t[f]&&this.parent===t.parent)return!1;for(var e=this;e.parent;e=e.parent)if(e.parent.id in t.ancestors){var n=e.parent;break}h("cursor and anticursor in the same tree",n);var i,r,s=t.ancestors[n.id],o=1;if(e[f]!==s)for(var a=e;a;a=a[1])if(a[1]===s[1]){o=f,i=e,r=s;break}return 1===o&&(i=s,r=e),i instanceof m&&(i=i[1]),r instanceof m&&(r=r[f]),this.hide().selection=n.selectChildren(i,r),this.insDirOf(o,this.selection.ends[o]),this.selectionChanged(),!0},t.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},t.deleteSelection=function(){this.selection&&(this[f]=this.selection.ends[f][f],this[1]=this.selection.ends[1][1],this.selection.remove(),this.selectionChanged(),delete this.selection)},t.replaceSelection=function(){var t=this.selection;return t&&(this[f]=t.ends[f][f],this[1]=t.ends[1][1],delete this.selection),t},t.depth=function(){for(var t=this,e=0;t=t.parent;)e+=t instanceof K?1:0;return e},t.isTooDeep=function(t){if(void 0!==this.options.maxDepth)return this.depth()+(t||0)>this.options.maxDepth}})),y=u(b,(function(t,e){t.init=function(){e.init.apply(this,arguments),this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()},t.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),e.adopt.apply(this,arguments)},t.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},t.join=function(t){return this.fold("",(function(e,n){return e+n[t]()}))}})),O=u((function(t){t.init=function(t,e,n){this.id=t.id,this.data={},this.root=t,this.container=e,this.options=n,t.controller=this,this.cursor=t.cursor=q(t,n)},t.handle=function(t,e){var n=this.options.handlers;if(n&&n.fns[t]){var i=n.APIClasses[this.KIND_OF_MQ](this);e===f||1===e?n.fns[t](e,i):n.fns[t](i)}};var e=[];this.onNotify=function(t){e.push(t)},t.notify=function(){for(var t=0;t<e.length;t+=1)e[t].apply(this.cursor,arguments);return this}})),k={},C=u(),j={},Q=u(),T={};function S(){window.console&&console.warn('You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. Easiest fix is to do the following before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')}function D(t){return S(),It(t)}D.prototype=Q.p,D.VERSION="v0.10.1",D.interfaceVersion=function(t){if(1!==t)throw"Only interface version 1 supported. You specified: "+t;return(S=function(){window.console&&console.warn('You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')})(),D},D.getInterface=A;var _=A.MIN=1,E=A.MAX=2;function A(n){if(!(_<=n&&n<=E))throw"Only interface versions between "+_+" and "+E+" supported. You specified: "+n;function i(t){if(!t||!t.nodeType)return null;var n=d(t).children(".mq-root-block").attr(e),i=n&&g.byId[n].controller;return i?s[i.KIND_OF_MQ](i):null}var s={};function o(t,e){for(var n in e&&e.handlers&&(e.handlers={fns:e.handlers,APIClasses:s}),e)if(e.hasOwnProperty(n)){var i=e[n],r=j[n];t[n]=r?r(i):i}}i.L=f,i.R=1,i.saneKeyboardEvents=I,i.config=function(t){return o(C.p,t),this},i.registerEmbed=function(t,e){if(!/^[a-z][a-z0-9]*$/i.test(t))throw"Embed name must start with letter and be only letters and digits";T[t]=e};var a=s.AbstractMathQuill=u(Q,(function(t){t.init=function(t){this.__controller=t,this.__options=t.options,this.id=t.id,this.data=t.data},t.__mathquillify=function(t){var n=this.__controller,i=n.root,r=n.container;n.createTextarea();var s=r.addClass(t).contents().detach();i.jQ=d('<span class="mq-root-block"/>').attr(e,i.id).appendTo(r),this.latex(s.text()),this.revert=function(){return r.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(s)}},t.config=function(t){return o(this.__options,t),this},t.el=function(){return this.__controller.container[0]},t.text=function(){return this.__controller.exportText()},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexMath(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},t.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},t.reflow=function(){return this.__controller.root.postOrder("reflow"),this}}));for(var l in i.prototype=a.prototype,s.EditableField=u(a,(function(e,n){e.__mathquillify=function(){return n.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},e.focus=function(){return this.__controller.textarea.focus(),this},e.blur=function(){return this.__controller.textarea.blur(),this},e.write=function(t){return this.__controller.writeLatex(t),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},e.empty=function(){var t=this.__controller.root,e=this.__controller.cursor;return t.eachChild("postOrder","dispose"),t.ends[f]=t.ends[1]=0,t.jQ.empty(),delete e.selection,e.insAtRightEnd(t),this},e.cmd=function(t){var e=this.__controller.notify(),n=e.cursor;if(/^\\[a-z]+$/i.test(t)&&!n.isTooDeep()){t=t.slice(1);var i=w[t]||At[t];i&&(t=i(t),n.selection&&t.replaces(n.replaceSelection()),t.createLeftOf(n.show()),this.__controller.scrollHoriz())}else n.parent.write(n,t);return e.blurred&&n.hide().parent.blur(),this},e.select=function(){var t=this.__controller;for(t.notify("move").cursor.insAtRightEnd(t.root);t.cursor[f];)t.selectLeft();return this},e.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},e.matrixCmd=function(t){var e=this.__controller.notify().cursor;return e.parent.parent instanceof Lt&&(t.match(/add/)?e.parent.parent.insert(t,e.parent):e.parent.parent.remove(t,e.parent)),this},e.getSelection=function(){return this.__controller.cursor.selection?this.__controller.cursor.selection.join("latex"):null},e.moveToDirEnd=function(t){return this.__controller.notify("move").cursor.insAtDirEnd(t,this.__controller.root),this},e.moveToLeftEnd=function(){return this.moveToDirEnd(f)},e.moveToRightEnd=function(){return this.moveToDirEnd(1)},e.keystroke=function(t){t=t.replace(/^\s+|\s+$/g,"").split(/\s+/);for(var e=0;e<t.length;e+=1)this.__controller.keystroke(t[e],{preventDefault:r});return this},e.typedText=function(t){for(var e=0;e<t.length;e+=1)this.__controller.typedText(t.charAt(e));return this},e.dropEmbedded=function(t,e,n){var i=t-d(window).scrollLeft(),r=e-d(window).scrollTop(),s=document.elementFromPoint(i,r);this.__controller.seek(d(s),t,e),Et().setOptions(n).createLeftOf(this.__controller.cursor)},e.clickAt=function(e,n,i){i=i||document.elementFromPoint(e,n);var r=this.__controller,s=r.root;return t.contains(s.jQ[0],i)||(i=s.jQ[0]),r.seek(d(i),e+pageXOffset,n+pageYOffset),r.blurred&&this.focus(),this},e.ignoreNextMousedown=function(t){return this.__controller.cursor.options.ignoreNextMousedown=t,this}})),i.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},i.EditableField.prototype=s.EditableField.prototype,k)!function(t,e){var r=s[t]=e(s);i[t]=function(e,s){var o=i(e);if(o instanceof r||!e||!e.nodeType)return o;var a=O(r.RootBlock(),d(e),C());return a.KIND_OF_MQ=t,r(a).__mathquillify(s,n)},i[t].prototype=r.prototype}(l,k[l]);return i}D.noConflict=function(){return window.MathQuill=L,D};var L=window.MathQuill;function z(t){for(var e="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf".split(" "),n=0;n<e.length;n+=1)!function(e){t[e]=function(t){this.controller.handle(e,t)}}(e[n]);t.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}window.MathQuill=D;var R,I=(R={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"},function(e,n){var i,s=null,o=null,a=null,l=t(e),c=t(n.container||l),h=r;function u(t){h=t,clearTimeout(i),i=setTimeout(t)}c.bind("keydown keypress input keyup focusout paste",(function(t){h(t)}));var f=!1;function p(){n.keystroke(function(t){var e,n=t.which||t.keyCode,i=R[n],r=[];return t.ctrlKey&&r.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&r.push("Meta"),t.altKey&&r.push("Alt"),t.shiftKey&&r.push("Shift"),e=i||String.fromCharCode(n),r.length||i?(r.push(e),r.join("-")):e}(s),s)}function d(){if(!("selectionStart"in(t=l[0]))||t.selectionStart===t.selectionEnd){var t,e=l.val();1===e.length?(l.val(""),n.typedText(e)):e&&l[0].select&&l[0].select()}}function m(){var t=l.val();l.val(""),t&&n.paste(t)}return c.bind({keydown:function(t){if(s=t,o=null,a=!1,f&&u((function(t){t&&"focusout"===t.type||!l[0].select||l[0].select(),h=r,clearTimeout(i)})),n.options.keyboardPassthrough){var e=t.which||t.keyCode,c=R[e];if(t.ctrlKey||t.originalEvent&&t.originalEvent.metaKey){var d=String.fromCharCode(e);"C"==d?n.cursor.selection&&(window.MathQuillClipboard=n.cursor.selection.join("latex")):"X"==d?n.cursor.selection&&(window.MathQuillClipboard=n.cursor.selection.join("latex"),n.cursor.deleteSelection()):"V"==d?window.MathQuillClipboard&&n.writeLatex(window.MathQuillClipboard):p(),a=!0}else(c||t.originalEvent&&t.originalEvent.metaKey||t.altKey)&&(p(),a=!0)}else p()},keypress:function(t){if(n.options.keyboardPassthrough){var e=t.which||t.keyCode;if(!a){var i=String.fromCharCode(e);n.typedText(i)}}else s&&o&&p(),o=t,u(d)},focusout:function(){s=o=null},paste:function(t){l.focus(),u(m)}}),{select:function(t){h(),h=r,clearTimeout(i),l.val(t),t&&l[0].select&&l[0].select(),f=!!t}}}),P=u((function(t,e,n){function i(t,e){throw"Parse Error: "+e+" at "+(t=t?"'"+t+"'":"EOF")}t.init=function(t){this._=t},t.parse=function(t){return this.skip(o)._(""+t,(function(t,e){return e}),i)},t.or=function(t){h("or is passed a parser",t instanceof n);var e=this;return n((function(n,i,r){return e._(n,i,(function(e){return t._(n,i,r)}))}))},t.then=function(t){var e=this;return n((function(i,r,s){return e._(i,(function(e,i){var o=t instanceof n?t:t(i);return h("a parser is returned",o instanceof n),o._(e,r,s)}),s)}))},t.many=function(){var t=this;return n((function(e,n,i){for(var r=[];t._(e,s,o););return n(e,r);function s(t,n){return e=t,r.push(n),!0}function o(){return!1}}))},t.times=function(t,e){arguments.length<2&&(e=t);var i=this;return n((function(n,r,s){for(var o,a=[],l=!0,c=0;c<t;c+=1)if(!(l=i._(n,h,u)))return s(n,o);for(;c<e&&l;c+=1)l=i._(n,h,f);return r(n,a);function h(t,e){return a.push(e),n=t,!0}function u(t,e){return o=e,n=t,!1}function f(t,e){return!1}}))},t.result=function(t){return this.then(s(t))},t.atMost=function(t){return this.times(0,t)},t.atLeast=function(t){var e=this;return e.times(t).then((function(t){return e.many().map((function(e){return t.concat(e)}))}))},t.map=function(t){return this.then((function(e){return s(t(e))}))},t.skip=function(t){return this.then((function(e){return t.result(e)}))};this.string=function(t){var e=t.length,i="expected '"+t+"'";return n((function(n,r,s){var o=n.slice(0,e);return o===t?r(n.slice(e),o):s(n,i)}))};var r=this.regex=function(t){h("regexp parser is anchored","^"===t.toString().charAt(1));var e="expected "+t;return n((function(n,i,r){var s=t.exec(n);if(s){var o=s[0];return i(n.slice(o.length),o)}return r(n,e)}))},s=n.succeed=function(t){return n((function(e,n){return n(e,t)}))},o=(n.fail=function(t){return n((function(e,n,i){return i(e,t)}))},n.letter=r(/^[a-z]/i),n.letters=r(/^[a-z]*/i),n.digit=r(/^[0-9]/),n.digits=r(/^[0-9]*/),n.whitespace=r(/^\s+/),n.optWhitespace=r(/^\s*/),n.any=n((function(t,e,n){return t?e(t.slice(1),t.charAt(0)):n(t,"expected any character")})),n.all=n((function(t,e,n){return e("",t)})),n.eof=n((function(t,e,n){return t?n(t,"expected EOF"):e(t,t)})))}));I=function(){var e={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(n,i){var s,o=null,a=null,l=null,c=t(n),h=t(i.container||c),u=r;function f(t){u=t,clearTimeout(s),s=setTimeout(t)}function p(t){f((function(e){u=r,clearTimeout(s),t(e)}))}h.bind("keydown keypress input keyup focusout paste",(function(t){u(t)}));var d=!1;function m(){i.keystroke(function(t){var n,i=t.which||t.keyCode,r=e[i],s=[];return t.ctrlKey&&s.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&s.push("Meta"),t.altKey&&s.push("Alt"),t.shiftKey&&s.push("Shift"),n=r||String.fromCharCode(i),s.length||r?(s.push(n),s.join("-")):n}(o),o)}function g(t){if(i.options.keyboardPassthrough){var e=t.which||t.keyCode;if(!l){var n=String.fromCharCode(e);i.typedText(n),a=t}}else o&&a&&m(),a=t,f(v)}function v(){if(!("selectionStart"in(t=c[0]))||t.selectionStart===t.selectionEnd){var t,e=c.val();1===e.length?(c.val(""),i.typedText(e)):e&&c[0].select&&c[0].select()}}function b(){var t=c.val();c.val(""),t&&i.paste(t)}return h.bind({keydown:function(t){if(o=t,a=null,l=!1,d&&p((function(t){t&&"focusout"===t.type||!c[0].select||c[0].select()})),i.options.keyboardPassthrough){var n=t.which||t.keyCode,r=e[n];if(t.ctrlKey||t.originalEvent&&t.originalEvent.metaKey){var s=String.fromCharCode(n);"C"==s?(i.cursor.selection&&(window.MathQuillClipboard=i.cursor.selection.join("latex")),l=!0):"X"==s?(i.cursor.selection&&(window.MathQuillClipboard=i.cursor.selection.join("latex"),i.cursor.deleteSelection()),l=!0):"V"==s?(window.MathQuillClipboard&&i.writeLatex(window.MathQuillClipboard),l=!0):("A"==s||r)&&(m(),l=!0)}else r&&"Spacebar"!==r?(m(),l=!0):191!==n||t.shiftKey||(t.preventDefault(),t.which=47,g(t))}else m()},keypress:g,keyup:function(t){i.options.keyboardPassthrough||o&&!a&&f(v)},focusout:function(){o=a=null},cut:function(){p((function(){i.cut()}))},copy:function(){p((function(){i.copy()}))},paste:function(t){c.focus(),f(b)}}),{select:function(t){u(),u=r,clearTimeout(s),c.val(t),t&&c[0].select&&c[0].select(),d=!!t}}}}();O.open((function(t,e){t.exportText=function(){return this.root.foldChildren("",(function(t,e){return t+e.text()}))}})),O.open((function(t){t.focusBlurEvents=function(){var t,e=this,n=e.root,i=e.cursor;e.textarea.focus((function(){e.blurred=!1,clearTimeout(t),e.container.addClass("mq-focused"),i.parent||i.insAtRightEnd(n),i.selection?(i.selection.jQ.removeClass("mq-blur"),e.selectionChanged()):i.show()})).blur((function(){e.blurred=!0,t=setTimeout((function(){n.postOrder("intentionalBlur"),i.selection&&i.selection.jQ.addClass("mq-blur"),i.hide().parent.blur(),e.container.removeClass("mq-focused")}),100)})),e.blurred=!0,i.hide().parent.blur()}})),O.open((function(t){t.keystroke=function(t,e){this.cursor.parent.keystroke(t,e,this)}})),g.open((function(t){t.keystroke=function(t,e,n){var i=n.cursor;switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":n.ctrlDeleteDir(f);break;case"Shift-Backspace":case"Backspace":n.backspace();break;case"Esc":case"Tab":return void n.escapeDir(1,t,e);case"Shift-Tab":case"Shift-Esc":return void n.escapeDir(f,t,e);case"End":n.notify("move").cursor.insAtRightEnd(i.parent);break;case"Ctrl-End":n.notify("move").cursor.insAtRightEnd(n.root);break;case"Shift-End":for(;i[1];)n.selectRight();break;case"Ctrl-Shift-End":for(;i[1]||i.parent!==n.root;)n.selectRight();break;case"Home":n.notify("move").cursor.insAtLeftEnd(i.parent);break;case"Ctrl-Home":n.notify("move").cursor.insAtLeftEnd(n.root);break;case"Shift-Home":for(;i[f];)n.selectLeft();break;case"Ctrl-Shift-Home":for(;i[f]||i.parent!==n.root;)n.selectLeft();break;case"Left":n.moveLeft();break;case"Shift-Left":n.selectLeft();break;case"Ctrl-Left":break;case"Right":n.moveRight();break;case"Shift-Right":n.selectRight();break;case"Ctrl-Right":break;case"Up":n.moveUp();break;case"Down":n.moveDown();break;case"Shift-Up":if(i[f])for(;i[f];)n.selectLeft();else n.selectLeft();case"Shift-Down":if(i[1])for(;i[1];)n.selectRight();else n.selectRight();case"Ctrl-Up":case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":n.ctrlDeleteDir(1);break;case"Shift-Del":case"Del":n.deleteForward();break;case"Meta-A":case"Ctrl-A":for(n.notify("move").cursor.insAtRightEnd(n.root);i[f];)n.selectLeft();break;default:return}e.preventDefault(),n.scrollHoriz()},t.moveOutOf=t.moveTowards=t.deleteOutOf=t.deleteTowards=t.unselectInto=t.selectOutOf=t.selectTowards=function(){h("overridden or never called on this node")}})),O.open((function(t){function e(t,e){var n=t.notify("upDown").cursor,i=e+"Into",r=e+"OutOf";return n[1][i]?n.insAtLeftEnd(n[1][i]):n[f][i]?n.insAtRightEnd(n[f][i]):n.parent.bubble((function(t){var e=t[r];if(e&&("function"==typeof e&&(e=t[r](n)),e instanceof g&&n.jumpUpDown(t,e),!0!==e))return!1})),t}this.onNotify((function(t){"move"!==t&&"upDown"!==t||this.show().clearSelection()})),t.escapeDir=function(t,e,n){p(t);var i=this.cursor;if(i.parent!==this.root&&n.preventDefault(),i.parent!==this.root)return i.parent.moveOutOf(t,i),this.notify("move")},j.leftRightIntoCmdGoes=function(t){if(t&&"up"!==t&&"down"!==t)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+t+'"';return t},t.moveDir=function(t){p(t);var e=this.cursor,n=e.options.leftRightIntoCmdGoes;return e.selection?e.insDirOf(t,e.selection.ends[t]):e[t]?e[t].moveTowards(t,e,n):e.parent.moveOutOf(t,e,n),this.notify("move")},t.moveLeft=function(){return this.moveDir(f)},t.moveRight=function(){return this.moveDir(1)},t.moveUp=function(){return e(this,"up")},t.moveDown=function(){return e(this,"down")},this.onNotify((function(t){"upDown"!==t&&(this.upDownCache={})})),this.onNotify((function(t){"edit"===t&&this.show().deleteSelection()})),t.deleteDir=function(t){p(t);var e=this.cursor,n=e.selection;return this.notify("edit"),n||(e[t]?e[t].deleteTowards(t,e):e.parent.deleteOutOf(t,e)),e[f].siblingDeleted&&e[f].siblingDeleted(e.options,1),e[1].siblingDeleted&&e[1].siblingDeleted(e.options,f),e.parent.bubble("reflow"),this},t.ctrlDeleteDir=function(t){p(t);var e=this.cursor;return!e[t]||e.selection?this.deleteDir(t):(this.notify("edit"),t===f?b(e.parent.ends[f],e[f]).remove():b(e[1],e.parent.ends[1]).remove(),e.insAtDirEnd(t,e.parent),e[f].siblingDeleted&&e[f].siblingDeleted(e.options,1),e[1].siblingDeleted&&e[1].siblingDeleted(e.options,f),e.parent.bubble("reflow"),this)},t.backspace=function(){return this.deleteDir(f)},t.deleteForward=function(){return this.deleteDir(1)},this.onNotify((function(t){"select"!==t&&this.endSelection()})),t.selectDir=function(t){var e=this.notify("select").cursor,n=e.selection;p(t),e.anticursor||e.startSelection();var i=e[t];i?n&&n.ends[t]===i&&e.anticursor[-t]!==i?i.unselectInto(t,e):i.selectTowards(t,e):e.parent.selectOutOf(t,e),e.clearSelection(),e.select()||e.show()},t.selectLeft=function(){return this.selectDir(f)},t.selectRight=function(){return this.selectDir(1)}}));var M=function(){function t(t){for(var e=t[0]||K(),n=1;n<t.length;n+=1)t[n].children().adopt(e,e.ends[1],0);return e}var e=P.string,n=P.regex,i=P.letter,r=P.any,s=P.optWhitespace,o=P.succeed,a=P.fail,l=i.map((function(t){return tt(t)})),c=n(/^[^${}\\_^]/).map((function(t){return $(t)})),h=n(/^[^\\a-eg-zA-Z]/).or(e("\\").then(n(/^[a-z]+/i).or(n(/^\s+/).result(" ")).or(r))).then((function(t){var e=w[t];return e?e(t).parser():a("unknown command: \\"+t)})).or(l).or(c),u=e("{").then((function(){return p})).skip(e("}")),f=s.then(u.or(h.map((function(t){var e=K();return t.adopt(e,0,0),e})))),p=f.many().map(t).skip(s),d=e("[").then(f.then((function(t){return"]"!==t.join("latex")?o(t):a()})).many().map(t).skip(s)).skip(e("]")),m=p;return m.block=f,m.optBlock=d,m}();O.open((function(t,e){t.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},j.maxDepth=function(t){return"number"==typeof t?t:void 0},t.writeLatex=function(t){var e=this.notify("edit").cursor,n=P.all,i=P.eof,r=M.skip(i).or(n.result(!1)).parse(t);if(r&&!r.isEmpty()&&r.prepareInsertionAt(e)){var s=r.ends[f];if(e.options.autoParenOperators&&!(s instanceof Tt)&&!(s instanceof wt)&&(e[f].isPartOfOperator&&(0===e[f][1]||e[f].jQ.hasClass("mq-last"))||(e[f].hasOwnProperty("sup")||e[f].hasOwnProperty("sub"))&&e[f][-1].isPartOfOperator)){var o="",a=e[f];for((e[f].hasOwnProperty("sup")||e[f].hasOwnProperty("sub"))&&e[f][-1].isPartOfOperator&&(a=e[f][-1]);a.isPartOfOperator&&!a.jQ.hasClass("mq-last")&&(o=a.letter+o,0!==a[-1]);)a=a[f];(!0===e.options.autoParenOperators||e.options.autoParenOperators.hasOwnProperty(o))&&e.parent.write(e,"(",!0)}r.children().adopt(e.parent,e[f],e[1]),r.jQize().insertBefore(e.jQ),e[f]=r.ends[1],r.finalizeInsert(e.options,e),r.ends[1][1].siblingCreated&&r.ends[1][1].siblingCreated(e.options,f),r.ends[f][f].siblingCreated&&r.ends[f][f].siblingCreated(e.options,1),e.parent.bubble("reflow")}return this},t.renderLatexMath=function(t){var e=this.root,n=this.cursor,i=(n.options,e.jQ),r=P.all,s=P.eof,o=M.skip(s).or(r.result(!1)).parse(t);if(e.eachChild("postOrder","dispose"),e.ends[f]=e.ends[1]=0,o&&o.prepareInsertionAt(n)){o.children().adopt(e,0,0);var a=o.join("html");i.html(a),e.jQize(i.children()),e.finalizeInsert(n.options)}else i.empty();delete n.selection,n.insAtRightEnd(e)},t.renderLatexText=function(t){var e=this.root,n=this.cursor;e.jQ.children().slice(1).remove(),e.eachChild("postOrder","dispose"),e.ends[f]=e.ends[1]=0,delete n.selection,n.show().insAtRightEnd(e);var i=P.regex,r=P.string,s=P.eof,o=P.all,a=r("$").then(M).skip(r("$").or(s)).map((function(t){var e=Y(n);e.createBlocks();var i=e.ends[f];return t.children().adopt(i,0,0),e})),l=r("\\$").result("$").or(i(/^[^$]/)).map($),c=a.or(l).many().skip(s).or(o.result(!1)).parse(t);if(c){for(var h=0;h<c.length;h+=1)c[h].adopt(e,e.ends[1],0);e.jQize().appendTo(e.jQ),e.finalizeInsert(n.options)}}})),O.open((function(n){C.p.ignoreNextMousedown=r,n.delegateMouseEvents=function(){var n=this.root.jQ;this.container.bind("mousedown.mathquill touchstart.mathquill",(function(i){var s=d(i.target).closest(".mq-root-block"),o=g.byId[s.attr(e)||n.attr(e)].controller,a=o.cursor,l=a.blink,c=o.textareaSpan,h=o.textarea;if(i.preventDefault(),i.target.unselectable=!0,!a.options.ignoreNextMousedown(i)){var u;if(a.options.ignoreNextMousedown=r,o.blurred&&(o.editable||s.prepend(c),h.focus()),a.blink=r,"touchstart"==i.type){var f=i.originalEvent.changedTouches[0]||i.originalEvent.touches[0],p=d(document.elementFromPoint(f.clientX,f.clientY));t.contains(s[0],p[0])&&o.seek(p,f.pageX,f.pageY).cursor.startSelection()}else o.seek(d(i.target),i.pageX,i.pageY).cursor.startSelection();s.bind("mousemove touchmove",m),d(i.target.ownerDocument).bind("mousemove touchmove",v).bind("mouseup touchend",(function t(e){a.blink=l,a.selection||(o.editable?a.show():c.detach()),s.unbind("mousemove touchmove",m),d(e.target.ownerDocument).unbind("mousemove touchmove",v).unbind("mouseup touchend",t)}))}function m(t){u=d(t.target)}function v(e){if(a.anticursor||a.startSelection(),"touchmove"==e.type){var n=e.originalEvent.changedTouches[0]||e.originalEvent.touches[0],i=d(document.elementFromPoint(n.clientX,n.clientY));t.contains(s[0],i[0])&&o.seek(i,n.pageX,n.pageY).cursor.select()}else o.seek(u,e.pageX,e.pageY).cursor.select();u=void 0}}))}})),O.open((function(t){t.seek=function(t,n,i){var r=this.notify("select").cursor;if(t){var s=t.attr(e)||t.attr("mathquill-command-id");if(!s){var o=t.parent();s=o.attr(e)||o.attr("mathquill-command-id")}}var a=s?g.byId[s]:this.root;return h("nodeId is the id of some Node that exists",a),r.clearSelection().show(),a.seek(n,r),this.scrollHoriz(),this}})),O.open((function(t){t.scrollHoriz=function(){var t=this.cursor,e=t.selection,n=this.root.jQ[0].getBoundingClientRect();if(e){var i=e.jQ[0].getBoundingClientRect(),r=i.left-(n.left+20),s=i.right-(n.right-20);if(e.ends[f]===t[1])if(r<0)a=r;else{if(!(s>0))return;if(i.left-s<n.left+20)a=r;else a=s}else if(s>0)a=s;else{if(!(r<0))return;if(i.right-r>n.right-20)a=s;else a=r}}else{var o=t.jQ[0].getBoundingClientRect().left;if(o>n.right-20)var a=o-(n.right-20);else{if(!(o<n.left+20))return;var a=o-(n.left+20)}}this.root.jQ.stop().animate({scrollLeft:"+="+a},100)}})),O.open((function(e){C.p.substituteTextarea=function(){return d("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0]},e.createTextarea=function(){var t=this.textareaSpan=d('<span class="mq-textarea"></span>'),e=this.options.substituteTextarea();if(!e.nodeType)throw"substituteTextarea() must return a DOM element, got "+e;e=this.textarea=d(e).appendTo(t);var n=this;n.cursor.selectionChanged=function(){n.selectionChanged()}},e.selectionChanged=function(){var t=this;mt(t.container[0]),void 0===t.textareaSelectionTimeout&&(t.textareaSelectionTimeout=setTimeout((function(){t.setTextareaSelection()})))},e.setTextareaSelection=function(){this.textareaSelectionTimeout=void 0;var t="";this.cursor.selection&&(t=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(t="$"+t+"$")),this.selectFn(t)},e.staticMathTextareaEvents=function(){var e=this,n=(e.root,e.cursor),i=e.textarea,r=e.textareaSpan;function s(){r.detach(),e.blurred=!0}this.container.prepend(t('<span class="mq-selectable">').text("$"+e.exportLatex()+"$")),e.blurred=!0,i.bind("cut paste",!1).bind("copy",(function(){e.setTextareaSelection()})).focus((function(){e.blurred=!1})).blur((function(){n.selection&&n.selection.clear(),setTimeout(s)})),e.selectFn=function(t){i.val(t),t&&i.select()}},C.p.substituteKeyboardEvents=I,e.editablesTextareaEvents=function(){var t=this.textarea,e=this.textareaSpan,n=this.options.substituteKeyboardEvents(t,this);this.selectFn=function(t){n.select(t)},this.container.prepend(e),this.focusBlurEvents()},e.typedText=function(t){if("\n"===t)return this.handle("enter");var e=this.notify().cursor;e.parent.write(e,t),this.scrollHoriz()},e.cut=function(){var t=this,e=t.cursor;e.selection&&setTimeout((function(){t.notify("edit"),e.parent.bubble("reflow")}))},e.copy=function(){this.setTextareaSelection()},e.paste=function(t){this.options.statelessClipboard&&(t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):"\\text{"+t+"}"),this.writeLatex(t).cursor.show()}}));var B=u(g,(function(t,e){t.finalizeInsert=function(t,e){this.postOrder("finalizeTree",t),this.postOrder("contactWeld",e),this.postOrder("blur"),this.postOrder("reflow"),this[1].siblingCreated&&this[1].siblingCreated(t,f),this[f].siblingCreated&&this[f].siblingCreated(t,1),this.bubble("reflow")},t.prepareInsertionAt=function(t){var e=t.options.maxDepth;if(void 0!==e){var n=t.depth();if(n>e)return!1;this.removeNodesDeeperThan(e-n)}return!0},t.removeNodesDeeperThan=function(t){for(var e,n=0,i=[[this,n]];i.length;)(e=i.shift())[0].children().each((function(r){var s=r instanceof K?1:0;(n=e[1]+s)<=t?i.push([r,n]):(s?r.children():r).remove()}))}})),F=u(B,(function(t,e){t.init=function(t,n,i){e.init.call(this),this.ctrlSeq||(this.ctrlSeq=t),n&&(this.htmlTemplate=n),i&&(this.textTemplate=i)},t.replaces=function(t){t.disown(),this.replacedFragment=t},t.isEmpty=function(){return this.foldChildren(!0,(function(t,e){return t&&e.isEmpty()}))},t.parser=function(){var t=M.block,e=this;return t.times(e.numBlocks()).map((function(t){e.blocks=t;for(var n=0;n<t.length;n+=1)t[n].adopt(e,e.ends[1],0);return e}))},t.createLeftOf=function(t){var n=this,i=n.replacedFragment;if(t.options.autoParenOperators&&!(n instanceof Tt)&&!(n instanceof wt)&&(t[f].isPartOfOperator&&(0===t[f][1]||t[f].jQ.hasClass("mq-last"))||(t[f].hasOwnProperty("sup")||t[f].hasOwnProperty("sub"))&&t[f][-1].isPartOfOperator)){var r="",s=t[f],o=!1;for((t[f].hasOwnProperty("sup")||t[f].hasOwnProperty("sub"))&&t[f][-1].isPartOfOperator&&(s=t[f][-1],o=!0);s.isPartOfOperator&&!s.jQ.hasClass("mq-last")&&(r=s.letter+r,0!==s[-1]);)s=s[f];if(!0===t.options.autoParenOperators||t.options.autoParenOperators.hasOwnProperty(r)){r+=n.letter;var a=!1;for(var l in t.options.autoOperatorNames)if(l.substring(0,r.length)===r){a=!0;break}0!=nt._maxLength&&a&&!o||t.parent.write(t,"(",!0)}}n.createBlocks(),e.createLeftOf.call(n,t),i&&(i.adopt(n.ends[f],0,0),i.jQ.appendTo(n.ends[f].jQ),n.placeCursor(t),n.prepareInsertionAt(t)),n.finalizeInsert(t.options),n.placeCursor(t)},t.createBlocks=function(){for(var t=this.numBlocks(),e=this.blocks=Array(t),n=0;n<t;n+=1){(e[n]=K()).adopt(this,this.ends[1],0)}},t.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[f],(function(t,e){return t.isEmpty()?t:e})))},t.moveTowards=function(t,e,n){var i=n&&this[n+"Into"];e.insAtDirEnd(-t,i||this.ends[-t])},t.deleteTowards=function(t,e){this.isEmpty()?e[t]=this.remove()[t]:this.moveTowards(t,e,null)},t.selectTowards=function(t,e){e[-t]=this,e[t]=this[t]},t.selectChildren=function(){return y(this,this)},t.unselectInto=function(t,e){e.insAtDirEnd(-t,e.anticursor.ancestors[this.id])},t.seek=function(t,e){function n(t){var e={};return e[f]=t.jQ.offset().left,e[1]=e[f]+t.jQ.outerWidth(),e}var i=this,r=n(i);if(t<r[f])return e.insLeftOf(i);if(t>r[1])return e.insRightOf(i);var s=r[f];i.eachChild((function(o){var a=n(o);return t<a[f]?(t-s<a[f]-t?o[f]?e.insAtRightEnd(o[f]):e.insLeftOf(i):e.insAtLeftEnd(o),!1):t>a[1]?void(o[1]?s=a[1]:r[1]-t<t-a[1]?e.insRightOf(i):e.insAtRightEnd(o)):(o.seek(t,e),!1)}))},t.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0},t.html=function(){var t=this.blocks,e=" mathquill-command-id="+this.id,n=this.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);h("no unmatched angle brackets",n.join("")===this.htmlTemplate);for(var i=0,r=n[0];r;r=n[i+=1])if("/>"===r.slice(-2))n[i]=r.slice(0,-2)+e+"/>";else if("<"===r.charAt(0)){h("not an unmatched top-level close tag","/"!==r.charAt(1)),n[i]=r.slice(0,-1)+e+">";var s=1;do{h("no missing close tags",r=n[i+=1]),"</"===r.slice(0,2)?s-=1:"<"===r.charAt(0)&&"/>"!==r.slice(-2)&&(s+=1)}while(s>0)}return n.join("").replace(/>&(\d+)/g,(function(e,n){return" mathquill-block-id="+t[n].id+">"+t[n].join("html")}))},t.latex=function(){return this.foldChildren(this.ctrlSeq,(function(t,e){return t+"{"+(e.latex()||" ")+"}"}))},t.textTemplate=[""],t.text=function(){var t=this,e=0;return t.foldChildren(t.textTemplate[e],(function(n,i){e+=1;var r=i.text();return n&&"("===t.textTemplate[e]&&"("===r[0]&&")"===r.slice(-1)?n+r.slice(1,-1)+t.textTemplate[e]:n+r+(t.textTemplate[e]||"")}))}})),N=u(F,(function(t,e){t.init=function(t,n,i){i||(i=t&&t.length>1?t.slice(1):t),e.init.call(this,t,n,[i])},t.parser=function(){return P.succeed(this)},t.numBlocks=function(){return 0},t.replaces=function(t){t.remove()},t.createBlocks=r,t.moveTowards=function(t,e){e.jQ.insDirOf(t,this.jQ),e[-t]=this,e[t]=this[t]},t.deleteTowards=function(t,e){e[t]=this.remove()[t]},t.seek=function(t,e){t-this.jQ.offset().left<this.jQ.outerWidth()/2?e.insLeftOf(this):e.insRightOf(this)},t.latex=function(){return this.ctrlSeq},t.text=function(){return this.textTemplate},t.placeCursor=r,t.isEmpty=function(){return!0}})),$=u(N,(function(t,e){t.init=function(t,n){e.init.call(this,t,"<span>"+(n||t)+"</span>")}})),V=u(N,(function(t,e){t.init=function(t,n,i){e.init.call(this,t,'<span class="mq-binary-operator">'+n+"</span>",i)}})),K=u(B,(function(t,e){t.join=function(t){return this.foldChildren("",(function(e,n){return e+n[t]()}))},t.html=function(){return this.join("html")},t.latex=function(){return this.join("latex")},t.text=function(){return this.ends[f]===this.ends[1]&&0!==this.ends[f]?this.ends[f].text():this.join("text")},t.keystroke=function(t,n,i){return!i.options.spaceBehavesLikeTab||"Spacebar"!==t&&"Shift-Spacebar"!==t||i.cursor.parent===i.root?e.keystroke.apply(this,arguments):(n.preventDefault(),void i.escapeDir("Shift-Spacebar"===t?f:1,t,n))},t.moveOutOf=function(t,e,n){!(n&&this.parent[n+"Into"])&&this[t]?e.insAtDirEnd(-t,this[t]):e.insDirOf(t,this.parent)},t.selectOutOf=function(t,e){e.insDirOf(t,this.parent)},t.deleteOutOf=function(t,e){e.unwrapGramp()},t.seek=function(t,e){var n=this.ends[1];if(!n||n.jQ.offset().left+n.jQ.outerWidth()<t)return e.insAtRightEnd(this);if(t<this.ends[f].jQ.offset().left)return e.insAtLeftEnd(this);for(;t<n.jQ.offset().left;)n=n[f];return n.seek(t,e)},t.chToCmd=function(t,e){var n;return t.match(/^[a-eg-zA-Z]$/)?tt(t):/^\d$/.test(t)?Z(t):e&&e.typingSlashWritesDivisionSymbol&&"/"===t?w["÷"](t):e&&e.typingAsteriskWritesTimesSymbol&&"*"===t?w["×"](t):(n=x[t]||w[t])?n(t):$(t)},t.write=function(t,e){var n=this.chToCmd(e,t.options);t.selection&&n.replaces(t.replaceSelection()),t.isTooDeep()||n.createLeftOf(t.show())},t.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},t.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}}));C.p.mouseEvents=!0,k.StaticMath=function(t){return u(t.AbstractMathQuill,(function(e,n){this.RootBlock=K,e.__mathquillify=function(t,e){return this.config(t),n.__mathquillify.call(this,"mq-math-mode"),this.__options.mouseEvents&&(this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents()),this},e.init=function(){n.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.MathField)},e.latex=function(){var e=n.latex.apply(this,arguments);return arguments.length>0&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.MathField),e}}))};var U=u(K,z);k.MathField=function(t){return u(t.EditableField,(function(t,e){this.RootBlock=U,t.__mathquillify=function(t,n){return this.config(t),n>1&&(this.__controller.root.reflow=r),e.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}}))};var W=u(g,(function(t,e){function n(t){t.jQ[0].normalize();var e=t.jQ[0].firstChild;if(e){h("only node in TextBlock span is Text node",3===e.nodeType);var n=H(e.data);return n.jQadd(e),t.children().disown(),n.adopt(t,0,0)}}t.ctrlSeq="\\text",t.replaces=function(t){t instanceof b?this.replacedText=t.remove().jQ.text():"string"==typeof t&&(this.replacedText=t)},t.jQadd=function(t){e.jQadd.call(this,t),this.ends[f]&&this.ends[f].jQadd(this.jQ[0].firstChild)},t.createLeftOf=function(t){if(e.createLeftOf.call(this,t),this[1].siblingCreated&&this[1].siblingCreated(t.options,f),this[f].siblingCreated&&this[f].siblingCreated(t.options,1),this.bubble("reflow"),t.insAtRightEnd(this),this.replacedText)for(var n=0;n<this.replacedText.length;n+=1)this.write(t,this.replacedText.charAt(n))},t.parser=function(){var t=this,e=P.string,n=P.regex;return P.optWhitespace.then(e("{")).then(n(/^[^}]*/)).skip(e("}")).map((function(e){return 0===e.length?b():(H(e).adopt(t,0,0),t)}))},t.textContents=function(){return this.foldChildren("",(function(t,e){return t+e.text}))},t.text=function(){return'"'+this.textContents()+'"'},t.latex=function(){var t=this.textContents();return 0===t.length?"":"\\text{"+t.replace(/\\/g,"\\backslash ").replace(/[{}]/g,"\\$&")+"}"},t.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"},t.moveTowards=function(t,e){e.insAtDirEnd(-t,this)},t.moveOutOf=function(t,e){e.insDirOf(t,this)},t.unselectInto=t.moveTowards,t.selectTowards=F.prototype.selectTowards,t.deleteTowards=F.prototype.deleteTowards,t.selectOutOf=function(t,e){e.insDirOf(t,this)},t.deleteOutOf=function(t,e){this.isEmpty()&&e.insRightOf(this)},t.write=function(t,n){if(t.show().deleteSelection(),"$"!==n)t[f]?t[f].appendText(n):H(n).createLeftOf(t);else if(this.isEmpty())t.insRightOf(this),$("\\$","$").createLeftOf(t);else if(t[1])if(t[f]){var i=W(),r=this.ends[f];r.disown().jQ.detach(),r.adopt(i,0,0),t.insLeftOf(this),e.createLeftOf.call(i,t)}else t.insLeftOf(this);else t.insRightOf(this)},t.seek=function(t,e){e.hide();var i=n(this),r=this.jQ.width()/this.text.length,s=Math.round((t-this.jQ.offset().left)/r);s<=0?e.insAtLeftEnd(this):s>=i.text.length?e.insAtRightEnd(this):e.insLeftOf(i.splitRight(s));for(var o=t-e.show().offset().left,a=o&&o<0?f:1,l=a;e[a]&&o*l>0;)e[a].moveTowards(a,e),l=o,o=t-e.offset().left;if(a*o<-a*l&&e[-a].moveTowards(-a,e),e.anticursor){if(e.anticursor.parent===this){var c=e[f]&&e[f].text.length;if(this.anticursorPosition===c)e.anticursor=m.copy(e);else{if(this.anticursorPosition<c){var h=e[f].splitRight(this.anticursorPosition);e[f]=h}else h=e[1].splitRight(this.anticursorPosition-c);e.anticursor=m(this,h[f],h)}}}else this.anticursorPosition=e[f]&&e[f].text.length},t.blur=function(t){K.prototype.blur.call(this),t&&(""===this.textContents()?(this.remove(),t[f]===this?t[f]=this[f]:t[1]===this&&(t[1]=this[1])):n(this))},t.focus=K.prototype.focus})),H=u(g,(function(t,e){function n(t,e){return e.charAt(t===f?0:-1+e.length)}t.init=function(t){e.init.call(this),this.text=t},t.jQadd=function(t){this.dom=t,this.jQ=d(t)},t.jQize=function(){return this.jQadd(document.createTextNode(this.text))},t.appendText=function(t){this.text+=t,this.dom.appendData(t)},t.prependText=function(t){this.text=t+this.text,this.dom.insertData(0,t)},t.insTextAtDirEnd=function(t,e){p(e),1===e?this.appendText(t):this.prependText(t)},t.splitRight=function(t){var e=H(this.text.slice(t)).adopt(this.parent,this,this[1]);return e.jQadd(this.dom.splitText(t)),this.text=this.text.slice(0,t),e},t.moveTowards=function(t,e){p(t);var i=n(-t,this.text),r=this[-t];return r?r.insTextAtDirEnd(i,t):H(i).createDir(-t,e),this.deleteTowards(t,e)},t.latex=function(){return this.text},t.deleteTowards=function(t,e){this.text.length>1?1===t?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),e[t]=this[t])},t.selectTowards=function(t,e){p(t);var i=e.anticursor,r=n(-t,this.text);if(i[t]===this){var s=H(r).createDir(t,e);i[t]=s,e.insDirOf(t,s)}else{var o=this[-t];if(o)o.insTextAtDirEnd(r,t);else(s=H(r).createDir(-t,e)).jQ.insDirOf(-t,e.selection.jQ);1===this.text.length&&i[-t]===this&&(i[-t]=this[-t])}return this.deleteTowards(t,e)}}));function X(t,e,n){return u(W,{ctrlSeq:t,htmlTemplate:"<"+e+" "+n+">&0</"+e+">"})}w.text=w.textnormal=w.textrm=w.textup=w.textmd=W,w.em=w.italic=w.italics=w.emph=w.textit=w.textsl=X("\\textit","i",'class="mq-text-mode"'),w.strong=w.bold=w.textbf=X("\\textbf","b",'class="mq-text-mode"'),w.sf=w.textsf=X("\\textsf","span",'class="mq-sans-serif mq-text-mode"'),w.tt=w.texttt=X("\\texttt","span",'class="mq-monospace mq-text-mode"'),w.textsc=X("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"'),w.uppercase=X("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),w.lowercase=X("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"');var Y=u(F,(function(t,e){t.init=function(t){e.init.call(this,"$"),this.cursor=t},t.htmlTemplate='<span class="mq-math-mode">&0</span>',t.createBlocks=function(){e.createBlocks.call(this),this.ends[f].cursor=this.cursor,this.ends[f].write=function(t,e){"$"!==e?K.prototype.write.call(this,t,e):this.isEmpty()?(t.insRightOf(this.parent),this.parent.deleteTowards(dir,t),$("\\$","$").createLeftOf(t.show())):t[1]?t[f]?K.prototype.write.call(this,t,e):t.insLeftOf(this.parent):t.insRightOf(this.parent)}},t.latex=function(){return"$"+this.ends[f].latex()+"$"}})),G=u(U,(function(t,e){t.keystroke=function(t){if("Spacebar"!==t&&"Shift-Spacebar"!==t)return e.keystroke.apply(this,arguments)},t.write=function(t,e){var n;(t.show().deleteSelection(),"$"===e)?Y(t).createLeftOf(t):("<"===e?n="&lt;":">"===e&&(n="&gt;"),$(e,n).createLeftOf(t))}}));k.TextField=function(t){return u(t.EditableField,(function(t,e){this.RootBlock=G,t.__mathquillify=function(){return e.__mathquillify.call(this,"mq-editable-field mq-text-mode")},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexText(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}}))},w.notin=w.cong=w.equiv=w.oplus=w.otimes=u(V,(function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}})),w["≠"]=w.ne=w.neq=c(V,"\\ne ","&ne;"),w["∗"]=w.ast=w.star=w.loast=w.lowast=c(V,"\\ast ","&lowast;"),w.therefor=w.therefore=c(V,"\\therefore ","&there4;"),w.cuz=w.because=c(V,"\\because ","&#8757;"),w.prop=w.propto=c(V,"\\propto ","&prop;"),w["≈"]=w.asymp=w.approx=c(V,"\\approx ","&asymp;"),w.isin=w.in=c(V,"\\in ","&isin;"),w.ni=w.contains=c(V,"\\ni ","&ni;"),w.notni=w.niton=w.notcontains=w.doesnotcontain=c(V,"\\not\\ni ","&#8716;"),w.sub=w.subset=c(V,"\\subset ","&sub;"),w.sup=w.supset=w.superset=c(V,"\\supset ","&sup;"),w.nsub=w.notsub=w.nsubset=w.notsubset=c(V,"\\not\\subset ","&#8836;"),w.nsup=w.notsup=w.nsupset=w.notsupset=w.nsuperset=w.notsuperset=c(V,"\\not\\supset ","&#8837;"),w.sube=w.subeq=w.subsete=w.subseteq=c(V,"\\subseteq ","&sube;"),w.supe=w.supeq=w.supsete=w.supseteq=w.supersete=w.superseteq=c(V,"\\supseteq ","&supe;"),w.nsube=w.nsubeq=w.notsube=w.notsubeq=w.nsubsete=w.nsubseteq=w.notsubsete=w.notsubseteq=c(V,"\\not\\subseteq ","&#8840;"),w.nsupe=w.nsupeq=w.notsupe=w.notsupeq=w.nsupsete=w.nsupseteq=w.notsupsete=w.notsupseteq=w.nsupersete=w.nsuperseteq=w.notsupersete=w.notsuperseteq=c(V,"\\not\\supseteq ","&#8841;"),w.N=w.naturals=w.Naturals=c($,"\\mathbb{N}","&#8469;"),w.P=w.primes=w.Primes=w.projective=w.Projective=w.probability=w.Probability=c($,"\\mathbb{P}","&#8473;"),w.Z=w.integers=w.Integers=c($,"\\mathbb{Z}","&#8484;"),w.Q=w.rationals=w.Rationals=c($,"\\mathbb{Q}","&#8474;"),w.R=w.reals=w.Reals=c($,"\\mathbb{R}","&#8477;"),w.C=w.complex=w.Complex=w.complexes=w.Complexes=w.complexplane=w.Complexplane=w.ComplexPlane=c($,"\\mathbb{C}","&#8450;"),w.H=w.Hamiltonian=w.quaternions=w.Quaternions=c($,"\\mathbb{H}","&#8461;"),w.quad=w.emsp=c($,"\\quad ","    "),w.qquad=c($,"\\qquad ","        "),w.diamond=c($,"\\diamond ","&#9671;"),w.bigtriangleup=c($,"\\bigtriangleup ","&#9651;"),w.ominus=c($,"\\ominus ","&#8854;"),w.uplus=c($,"\\uplus ","&#8846;"),w.bigtriangledown=c($,"\\bigtriangledown ","&#9661;"),w.sqcap=c($,"\\sqcap ","&#8851;"),w.triangleleft=c($,"\\triangleleft ","&#8882;"),w.sqcup=c($,"\\sqcup ","&#8852;"),w.triangleright=c($,"\\triangleright ","&#8883;"),w.odot=w.circledot=c($,"\\odot ","&#8857;"),w.bigcirc=c($,"\\bigcirc ","&#9711;"),w.dagger=c($,"\\dagger ","&#0134;"),w.ddagger=c($,"\\ddagger ","&#135;"),w.wr=c($,"\\wr ","&#8768;"),w.amalg=c($,"\\amalg ","&#8720;"),w.models=c($,"\\models ","&#8872;"),w.prec=c($,"\\prec ","&#8826;"),w.succ=c($,"\\succ ","&#8827;"),w.preceq=c($,"\\preceq ","&#8828;"),w.succeq=c($,"\\succeq ","&#8829;"),w.simeq=c($,"\\simeq ","&#8771;"),w.mid=c($,"\\mid ","&#8739;"),w.ll=c($,"\\ll ","&#8810;"),w.gg=c($,"\\gg ","&#8811;"),w.parallel=c($,"\\parallel ","&#8741;"),w.nparallel=c($,"\\nparallel ","&#8742;"),w.bowtie=c($,"\\bowtie ","&#8904;"),w.sqsubset=c($,"\\sqsubset ","&#8847;"),w.sqsupset=c($,"\\sqsupset ","&#8848;"),w.smile=c($,"\\smile ","&#8995;"),w.sqsubseteq=c($,"\\sqsubseteq ","&#8849;"),w.sqsupseteq=c($,"\\sqsupseteq ","&#8850;"),w.doteq=c($,"\\doteq ","&#8784;"),w.frown=c($,"\\frown ","&#8994;"),w.vdash=c($,"\\vdash ","&#8870;"),w.dashv=c($,"\\dashv ","&#8867;"),w.nless=c($,"\\nless ","&#8814;"),w.ngtr=c($,"\\ngtr ","&#8815;"),w.longleftarrow=c($,"\\longleftarrow ","&#8592;"),w.longrightarrow=c($,"\\longrightarrow ","&#8594;"),w.Longleftarrow=c($,"\\Longleftarrow ","&#8656;"),w.Longrightarrow=c($,"\\Longrightarrow ","&#8658;"),w.longleftrightarrow=c($,"\\longleftrightarrow ","&#8596;"),w.updownarrow=c($,"\\updownarrow ","&#8597;"),w.Longleftrightarrow=c($,"\\Longleftrightarrow ","&#8660;"),w.Updownarrow=c($,"\\Updownarrow ","&#8661;"),w.mapsto=c($,"\\mapsto ","&#8614;"),w.nearrow=c($,"\\nearrow ","&#8599;"),w.hookleftarrow=c($,"\\hookleftarrow ","&#8617;"),w.hookrightarrow=c($,"\\hookrightarrow ","&#8618;"),w.searrow=c($,"\\searrow ","&#8600;"),w.leftharpoonup=c($,"\\leftharpoonup ","&#8636;"),w.rightharpoonup=c($,"\\rightharpoonup ","&#8640;"),w.swarrow=c($,"\\swarrow ","&#8601;"),w.leftharpoondown=c($,"\\leftharpoondown ","&#8637;"),w.rightharpoondown=c($,"\\rightharpoondown ","&#8641;"),w.nwarrow=c($,"\\nwarrow ","&#8598;"),w.ldots=c($,"\\ldots ","&#8230;"),w.cdots=c($,"\\cdots ","&#8943;"),w.vdots=c($,"\\vdots ","&#8942;"),w.ddots=c($,"\\ddots ","&#8945;"),w.surd=c($,"\\surd ","&#8730;"),w.triangle=c($,"\\triangle ","&#9651;"),w.ell=c($,"\\ell ","&#8467;"),w.top=c($,"\\top ","&#8868;"),w.flat=c($,"\\flat ","&#9837;"),w.natural=c($,"\\natural ","&#9838;"),w.sharp=c($,"\\sharp ","&#9839;"),w.wp=c($,"\\wp ","&#8472;"),w.bot=c($,"\\bot ","&#8869;"),w.clubsuit=c($,"\\clubsuit ","&#9827;"),w.diamondsuit=c($,"\\diamondsuit ","&#9826;"),w.heartsuit=c($,"\\heartsuit ","&#9825;"),w.spadesuit=c($,"\\spadesuit ","&#9824;"),w.parallelogram=c($,"\\parallelogram ","&#9649;"),w.square=c($,"\\square ","&#11036;"),w.oint=c($,"\\oint ","&#8750;"),w.bigcap=c($,"\\bigcap ","&#8745;"),w.bigcup=c($,"\\bigcup ","&#8746;"),w.bigsqcup=c($,"\\bigsqcup ","&#8852;"),w.bigvee=c($,"\\bigvee ","&#8744;"),w.bigwedge=c($,"\\bigwedge ","&#8743;"),w.bigodot=c($,"\\bigodot ","&#8857;"),w.bigotimes=c($,"\\bigotimes ","&#8855;"),w.bigoplus=c($,"\\bigoplus ","&#8853;"),w.biguplus=c($,"\\biguplus ","&#8846;"),w.lfloor=c($,"\\lfloor ","&#8970;"),w.rfloor=c($,"\\rfloor ","&#8971;"),w.lceil=c($,"\\lceil ","&#8968;"),w.rceil=c($,"\\rceil ","&#8969;"),w.opencurlybrace=w.lbrace=c($,"\\lbrace ","{"),w.closecurlybrace=w.rbrace=c($,"\\rbrace ","}"),w.lbrack=c($,"["),w.rbrack=c($,"]"),w.slash=c($,"/"),w.vert=c($,"|"),w.perp=w.perpendicular=c($,"\\perp ","&perp;"),w.nabla=w.del=c($,"\\nabla ","&nabla;"),w.hbar=c($,"\\hbar ","&#8463;"),w.AA=w.Angstrom=w.angstrom=c($,"\\text\\AA ","&#8491;"),w.ring=w.circ=w.circle=c($,"\\circ ","&#8728;"),w.bull=w.bullet=c($,"\\bullet ","&bull;"),w.setminus=w.smallsetminus=c($,"\\setminus ","&#8726;"),w.not=w["¬"]=w.neg=c($,"\\neg ","&not;"),w["…"]=w.dots=w.ellip=w.hellip=w.ellipsis=w.hellipsis=c($,"\\dots ","&hellip;"),w.converges=w.darr=w.dnarr=w.dnarrow=w.downarrow=c($,"\\downarrow ","&darr;"),w.dArr=w.dnArr=w.dnArrow=w.Downarrow=c($,"\\Downarrow ","&dArr;"),w.diverges=w.uarr=w.uparrow=c($,"\\uparrow ","&uarr;"),w.uArr=w.Uparrow=c($,"\\Uparrow ","&uArr;"),w.to=c(V,"\\to ","&rarr;"),w.rarr=w.rightarrow=c($,"\\rightarrow ","&rarr;"),w.implies=c(V,"\\Rightarrow ","&rArr;"),w.rArr=w.Rightarrow=c($,"\\Rightarrow ","&rArr;"),w.gets=c(V,"\\gets ","&larr;"),w.larr=w.leftarrow=c($,"\\leftarrow ","&larr;"),w.impliedby=c(V,"\\Leftarrow ","&lArr;"),w.lArr=w.Leftarrow=c($,"\\Leftarrow ","&lArr;"),w.harr=w.lrarr=w.leftrightarrow=c($,"\\leftrightarrow ","&harr;"),w.iff=c(V,"\\Leftrightarrow ","&hArr;"),w.hArr=w.lrArr=w.Leftrightarrow=c($,"\\Leftrightarrow ","&hArr;"),w.Re=w.Real=w.real=c($,"\\Re ","&real;"),w.Im=w.imag=w.image=w.imagin=w.imaginary=w.Imaginary=c($,"\\Im ","&image;"),w.part=w.partial=c($,"\\partial ","&part;"),w.infty=w.infin=w.infinity=c($,"\\infty ","&infin;"),w.pounds=c($,"\\pounds ","&pound;"),w.alef=w.alefsym=w.aleph=w.alephsym=c($,"\\aleph ","&alefsym;"),w.xist=w.xists=w.exist=w.exists=c($,"\\exists ","&exist;"),w.nexists=w.nexist=c($,"\\nexists ","&#8708;"),w.and=w.land=w.wedge=c(V,"\\wedge ","&and;"),w.or=w.lor=w.vee=c(V,"\\vee ","&or;"),w.o=w.O=w.empty=w.emptyset=w.oslash=w.Oslash=w.nothing=w.varnothing=c(V,"\\varnothing ","&empty;"),w.cup=w.union=c(V,"\\cup ","&cup;"),w.cap=w.intersect=w.intersection=c(V,"\\cap ","&cap;"),w.deg=w.degree=c($,"\\degree ","&deg;"),w.ang=w.angle=c($,"\\angle ","&ang;"),w.measuredangle=c($,"\\measuredangle ","&#8737;");var Z=u($,(function(t,e){t.createLeftOf=function(t){t.options.autoSubscriptNumerals&&t.parent!==t.parent.parent.sub&&(t[f]instanceof J&&!1!==t[f].isItalic||t[f]instanceof wt&&t[f][f]instanceof J&&!1!==t[f][f].isItalic||t[f]instanceof Tt&&")"==t[f].sides[1].ch||t[f]instanceof wt&&t[f][f]instanceof Tt&&")"==t[f][f].sides[1].ch)?(w._().createLeftOf(t),e.createLeftOf.call(this,t),t.insRightOf(t.parent.parent)):e.createLeftOf.call(this,t)}})),J=u(N,(function(t,e){t.init=function(t,n){e.init.call(this,t,"<var>"+(n||t)+"</var>")},t.text=function(){var t=this.ctrlSeq;return this.isPartOfOperator?"\\"==t[0]?t=t.slice(1,t.length):" "==t[t.length-1]&&(t=t.slice(0,-1)):(!this[f]||this[f]instanceof J||this[f]instanceof V||"\\ "===this[f].ctrlSeq||(t="*"+t),!this[1]||this[1]instanceof V||this[1]instanceof wt||(t+="*")),t}}));C.p.autoCommands={_maxLength:0},j.autoCommands=function(t){if(!/^\^?[a-z]+(?: \^?[a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(var e=t.split(" "),n={},r=0,s=0;s<e.length;s+=1){var o=e[s];if(o.length<2)throw'autocommand "'+o+'" not minimum length of 2';if(w[o]===rt)throw'"'+o+'" is a built-in operator name';n[o]=1,r=i(r,o.length)}return n._maxLength=r,n};var tt=u(J,(function(t,e){function i(t){return!t||t instanceof V||t instanceof qt}t.init=function(t){return e.init.call(this,this.letter=t)},t.createLeftOf=function(t){e.createLeftOf.apply(this,arguments);var n=t.options.autoCommands,i=n._maxLength;if(i>0){for(var r="",s=this,o=0;s instanceof tt&&s.ctrlSeq===s.letter&&o<i;)r=s.letter+r,s=s[f],o+=1;for(o=0;r.length;){if(n.hasOwnProperty(r)||0==o&&n.hasOwnProperty("^"+r)){for(o=1,s=this;o<r.length;o+=1,s=s[f]);return b(s,this).remove(),t[f]=s[f],w[r](r).createLeftOf(t)}o++,r=r.slice(1)}}},t.italicize=function(t){return this.isItalic=t,this.isPartOfOperator=!t,this.jQ.toggleClass("mq-operator-name",!t),this},t.finalizeTree=t.siblingDeleted=t.siblingCreated=function(t,e){e!==f&&this[1]instanceof tt||this.autoUnItalicize(t)},t.autoUnItalicize=function(t){var e=t.autoOperatorNames;if(0!==e._maxLength){for(var r=this.letter,s=this[f];s instanceof tt;s=s[f])r=s.letter+r;for(var o=this[1];o instanceof tt;o=o[1])r+=o.letter;b(s[1]||this.parent.ends[f],o[f]||this.parent.ends[1]).each((function(t){t.italicize(!0).jQ.removeClass("mq-first mq-last mq-followed-by-supsub"),t.ctrlSeq=t.letter}));t:for(var a=0,l=s[1]||this.parent.ends[f];a<r.length;a+=1,l=l[1])for(var c=n(e._maxLength,r.length-a);c>0;c-=1){var h=r.slice(a,a+c);if(e.hasOwnProperty(h)){for(var u=0,p=l;u<c;u+=1,p=p[1]){p.italicize(!1);var d=p}var m=et.hasOwnProperty(h);if(l.ctrlSeq=(m?"\\":"\\operatorname{")+l.ctrlSeq,d.ctrlSeq+=m?" ":"}",it.hasOwnProperty(h)&&d[f][f][f].jQ.addClass("mq-last"),i(l[f])||l.jQ.addClass("mq-first"),!i(d[1]))if(d[1]instanceof wt){var g=d[1];(g.siblingCreated=g.siblingDeleted=function(){g.jQ.toggleClass("mq-after-operator-name",!(g[1]instanceof Tt))})()}else d.jQ.toggleClass("mq-last",!(d[1]instanceof Tt));a+=c-1,l=d;continue t}}}}})),et={},nt=C.p.autoOperatorNames={_maxLength:9},it={limsup:1,liminf:1,projlim:1,injlim:1};!function(){for(var t="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" "),e=0;e<t.length;e+=1)et[t[e]]=nt[t[e]]=1;var n="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" ");for(e=0;e<n.length;e+=1)et[n[e]]=1;var i="sin cos tan sec cosec csc cotan cot ctg".split(" ");for(e=0;e<i.length;e+=1)nt[i[e]]=nt["arc"+i[e]]=nt[i[e]+"h"]=nt["ar"+i[e]+"h"]=nt["arc"+i[e]+"h"]=1;var r="gcf hcf lcm proj span".split(" ");for(e=0;e<r.length;e+=1)nt[r[e]]=1}(),j.autoOperatorNames=function(t){if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(var e=t.split(" "),n={},r=0,s=0;s<e.length;s+=1){var o=e[s];if(o.length<2)throw'"'+o+'" not minimum length of 2';n[o]=1,r=i(r,o.length)}return n._maxLength=r,n},j.autoParenOperators=function(t){if(!0===t)return!0;if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(var e=t.split(" "),n={},r=0,s=0;s<e.length;s+=1){var o=e[s];if(o.length<2)throw'"'+o+'" not minimum length of 2';n[o]=1,r=i(r,o.length)}return n._maxLength=r,n};var rt=u(N,(function(t,e){t.init=function(t){this.ctrlSeq=t},t.createLeftOf=function(t){for(var e=this.ctrlSeq,n=0;n<e.length;n+=1)tt(e.charAt(n)).createLeftOf(t)},t.parser=function(){for(var t=this.ctrlSeq,e=K(),n=0;n<t.length;n+=1)tt(t.charAt(n)).adopt(e,e.ends[1],0);return P.succeed(e.children())}}));for(var st in nt)nt.hasOwnProperty(st)&&(w[st]=rt);w.operatorname=u(F,(function(t){t.createLeftOf=r,t.numBlocks=function(){return 1},t.parser=function(){return M.block.map((function(t){return t.children()}))}})),w.f=u(tt,(function(t,e){t.init=function(){N.p.init.call(this,this.letter="f",'<var class="mq-f">f</var>')},t.italicize=function(t){return this.jQ.html("f").toggleClass("mq-f",t),e.italicize.apply(this,arguments)}})),w[" "]=w.space=c($,"\\ ","&nbsp;"),w["'"]=w.prime=c($,"'","&prime;"),w["″"]=w.dprime=c($,"″","&Prime;"),w.backslash=c($,"\\backslash ","\\"),x["\\"]||(x["\\"]=w.backslash),w.$=c($,"\\$","$");var ot=u(N,(function(t,e){t.init=function(t,n){e.init.call(this,t,'<span class="mq-nonSymbola">'+(n||t)+"</span>")}}));w["@"]=ot,w["&"]=c(ot,"\\&","&amp;"),w["%"]=c(ot,"\\%","%"),w.alpha=w.beta=w.gamma=w.delta=w.zeta=w.eta=w.theta=w.iota=w.kappa=w.mu=w.nu=w.xi=w.rho=w.sigma=w.tau=w.chi=w.psi=w.omega=u(J,(function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}})),w.phi=c(J,"\\phi ","&#981;"),w.phiv=w.varphi=c(J,"\\varphi ","&phi;"),w.epsilon=c(J,"\\epsilon ","&#1013;"),w.epsiv=w.varepsilon=c(J,"\\varepsilon ","&epsilon;"),w.piv=w.varpi=c(J,"\\varpi ","&piv;"),w.sigmaf=w.sigmav=w.varsigma=c(J,"\\varsigma ","&sigmaf;"),w.thetav=w.vartheta=w.thetasym=c(J,"\\vartheta ","&thetasym;"),w.upsilon=w.upsi=c(J,"\\upsilon ","&upsilon;"),w.gammad=w.Gammad=w.digamma=c(J,"\\digamma ","&#989;"),w.kappav=w.varkappa=c(J,"\\varkappa ","&#1008;"),w.rhov=w.varrho=c(J,"\\varrho ","&#1009;"),w.pi=w["π"]=c(ot,"\\pi ","&pi;"),w.lambda=c(ot,"\\lambda ","&lambda;"),w.Upsilon=w.Upsi=w.upsih=w.Upsih=c(N,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),w.Gamma=w.Delta=w.Theta=w.Lambda=w.Xi=w.Pi=w.Sigma=w.Phi=w.Psi=w.Omega=w.forall=u($,(function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}));var at=u(F,(function(t){t.init=function(t){this.latex=t},t.createLeftOf=function(t){var e=M.parse(this.latex);e.children().adopt(t.parent,t[f],t[1]),t[f]=e.ends[1],e.jQize().insertBefore(t.jQ),e.finalizeInsert(t.options,t),e.ends[1][1].siblingCreated&&e.ends[1][1].siblingCreated(t.options,f),e.ends[f][f].siblingCreated&&e.ends[f][f].siblingCreated(t.options,1),t.parent.bubble("reflow")},t.parser=function(){var t=M.parse(this.latex).children();return P.succeed(t)}}));w["¹"]=c(at,"^1"),w["²"]=c(at,"^2"),w["³"]=c(at,"^3"),w["¼"]=c(at,"\\frac14"),w["½"]=c(at,"\\frac12"),w["¾"]=c(at,"\\frac34");var lt=u(V,(function(t,e){t.init=$.prototype.init,t.contactWeld=t.siblingCreated=t.siblingDeleted=function(t,e){if(1!==e)return this.jQ[0].className=function t(e){return e[f]?e[f]instanceof V||/^[,;:\(\[]$/.test(e[f].ctrlSeq)?"":"mq-binary-operator":e.parent&&e.parent.parent&&e.parent.parent.isStyleBlock()?t(e.parent.parent):""}(this),this},t.createLeftOf=function(t){if(t.options.quickplusminus&&t[f]instanceof lt&&"+"==t[f].ctrlSeq&&"-"==this.ctrlSeq)return t[f].ctrlSeq="\\pm ",t[f].text="\\pm ",t[f].htmlTemplate="<span>&plusmn;</span>",t[f].jQ.html("&plusmn;"),void t[f].bubble("reflow");e.createLeftOf.apply(this,arguments)}}));w["+"]=c(lt,"+","+"),w["–"]=w["-"]=c(lt,"-","&minus;"),w["±"]=w.pm=w.plusmn=w.plusminus=c(lt,"\\pm ","&plusmn;"),w.mp=w.mnplus=w.minusplus=c(lt,"\\mp ","&#8723;"),x["*"]=w.sdot=w.cdot=c(V,"\\cdot ","&middot;","*");var ct=u(V,(function(t,e){t.init=function(t,n){this.data=t,this.strict=n;var i=n?"Strict":"";e.init.call(this,t["ctrlSeq"+i],t["html"+i],t["text"+i])},t.swap=function(t){this.strict=t;var e=t?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+e],this.jQ.html(this.data["html"+e]),this.textTemplate=[this.data["text"+e]]},t.deleteTowards=function(t,n){if(t===f&&!this.strict)return this.swap(!0),void this.bubble("reflow");e.deleteTowards.apply(this,arguments)}})),ht={ctrlSeq:"\\le ",html:"&le;",text:"≤",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},ut={ctrlSeq:"\\ge ",html:"&ge;",text:"≥",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"};w["<"]=w.lt=c(ct,ht,!0),w[">"]=w.gt=c(ct,ut,!0),w["≤"]=w.le=w.leq=c(ct,ht,!1),w["≥"]=w.ge=w.geq=c(ct,ut,!1);var ft=u(V,(function(t,e){t.init=function(){e.init.call(this,"=","=")},t.createLeftOf=function(t){if(t[f]instanceof ct&&t[f].strict)return t[f].swap(!1),void t[f].bubble("reflow");e.createLeftOf.apply(this,arguments)}}));w["="]=ft,w["×"]=w.times=c(V,"\\times ","&times;","[x]"),w["÷"]=w.div=w.divide=w.divides=c(V,"\\div ","&divide;","[/]"),x["~"]=w.sim=c(V,"\\sim ","~","~");var pt,dt,mt=r,gt=document.createElement("div").style;for(var vt in{transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1})if(vt in gt){dt=vt;break}dt?pt=function(t,e,n){t.css(dt,"scale("+e+","+n+")")}:"filter"in gt?(mt=function(t){t.className=t.className},pt=function(t,e,n){e/=1+(n-1)/2,t.css("fontSize",n+"em"),t.hasClass("mq-matrixed-container")||t.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>');var i=t.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+e+",SizingMethod='auto expand')");function r(){t.css("marginRight",(i.width()-1)*(e-1)/e+"px")}r();var s=setInterval(r);d(window).load((function(){clearTimeout(s),r()}))}):pt=function(t,e,n){t.css("fontSize",n+"em")};var bt=u(F,(function(t,e){t.init=function(t,n,i){e.init.call(this,t,"<"+n+" "+i+">&0</"+n+">")}}));w.mathrm=c(bt,"\\mathrm","span",'class="mq-roman mq-font"'),w.mathit=c(bt,"\\mathit","i",'class="mq-font"'),w.mathbf=c(bt,"\\mathbf","b",'class="mq-font"'),w.mathsf=c(bt,"\\mathsf","span",'class="mq-sans-serif mq-font"'),w.mathtt=c(bt,"\\mathtt","span",'class="mq-monospace mq-font"'),w.underline=c(bt,"\\underline","span",'class="mq-non-leaf mq-underline"'),w.overline=w.bar=c(bt,"\\overline","span",'class="mq-non-leaf mq-overline"'),w.overrightarrow=c(bt,"\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"'),w.overleftarrow=c(bt,"\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"'),w.overleftrightarrow=c(bt,"\\overleftrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-both"'),w.overarc=c(bt,"\\overarc","span",'class="mq-non-leaf mq-overarc"'),w.dot=u(F,(function(t,e){t.init=function(){e.init.call(this,"\\dot",'<span class="mq-non-leaf"><span class="mq-dot-recurring-inner"><span class="mq-dot-recurring">&#x2d9;</span><span class="mq-empty-box">&0</span></span></span>')}}));w.textcolor=u(F,(function(t,e){t.setColor=function(t){this.color=t,this.htmlTemplate='<span class="mq-textcolor" style="color:'+t+'">&0</span>'},t.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},t.parser=function(){var t=this,n=P.optWhitespace,i=P.string,r=P.regex;return n.then(i("{")).then(r(/^[#\w\s.,()%-]*/)).skip(i("}")).then((function(n){return t.setColor(n),e.parser.call(t)}))},t.isStyleBlock=function(){return!0}})),w.class=u(F,(function(t,e){t.parser=function(){var t=this,n=P.string,i=P.regex;return P.optWhitespace.then(n("{")).then(i(/^[-\w\s\\\xA0-\xFF]*/)).skip(n("}")).then((function(n){return t.cls=n||"",t.htmlTemplate='<span class="mq-class '+n+'">&0</span>',e.parser.call(t)}))},t.latex=function(){return"\\class{"+this.cls+"}{"+this.blocks[0].latex()+"}"},t.isStyleBlock=function(){return!0}}));var wt=u(F,(function(t,n){t.ctrlSeq="_{...}^{...}",t.createLeftOf=function(t){if(this.replacedFragment||t[f]||!t.options.supSubsRequireOperand)return n.createLeftOf.apply(this,arguments)},t.contactWeld=function(t){for(var e=f;e;e=e===f&&1)if(this[e]instanceof wt){for(var n="sub";n;n="sub"===n&&"sup"){var i=this[n],r=this[e][n];if(i){if(r)if(i.isEmpty())o=m(r,0,r.ends[f]);else{i.jQ.children().insAtDirEnd(-e,r.jQ);var s=i.children().disown(),o=m(r,s.ends[1],r.ends[f]);e===f?s.adopt(r,r.ends[1],0):s.adopt(r,0,r.ends[f])}else this[e].addBlock(i.disown());this.placeCursor=function(t,n){return function(i){i.insAtDirEnd(-e,t||n)}}(r,i)}}this.remove(),t&&t[f]===this&&(1===e&&o?o[f]?t.insRightOf(o[f]):t.insAtLeftEnd(o.parent):t.insRightOf(this[e]));break}},C.p.charsThatBreakOutOfSupSub="",t.finalizeTree=function(){this.ends[f].write=function(t,e,n){if(t.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===e)return;var i=this.chToCmd(e,t.options);return i instanceof N?t.deleteSelection():t.clearSelection().insRightOf(this.parent),i.createLeftOf(t.show())}t[f]&&!t[1]&&!t.selection&&!n&&t.options.charsThatBreakOutOfSupSub.indexOf(e)>-1&&(t.insRightOf(this.parent)," "==e)||(t[f]&&!t[1]&&!t.selection&&!n&&this.parent[f]instanceof J&&(!1!==this.parent[f].isItalic&&"e"!==this.parent[f].letter&&!t[f].isPartOfOperator&&t.options.charsThatBreakOutOfSupSubVar.indexOf(e)>-1||this.parent[f].isPartOfOperator&&t.options.charsThatBreakOutOfSupSubOp.indexOf(e)>-1)&&t.insRightOf(this.parent),K.p.write.apply(this,arguments))}},t.moveTowards=function(t,e,i){e.options.autoSubscriptNumerals&&!this.sup?e.insDirOf(t,this):n.moveTowards.apply(this,arguments)},t.deleteTowards=function(t,e){if(e.options.autoSubscriptNumerals&&this.sub){var i=this.sub.ends[-t];i instanceof N?i.remove():i&&i.deleteTowards(t,e.insAtDirEnd(-t,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(f,e.insAtLeftEnd(this.sub)),this.sup&&e.insDirOf(-t,this))}else n.deleteTowards.apply(this,arguments)},t.latex=function(){function t(t,e){var n=e&&e.latex();return e?t+(1===n.length?n:"{"+(n||" ")+"}"):""}return t("_",this.sub)+t("^",this.sup)},t.addBlock=function(t){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=t,t.adopt(this,this.sub,0).downOutOf=this.sub,t.jQ=d('<span class="mq-sup"/>').append(t.jQ.children()).attr(e,t.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=t,t.adopt(this,0,this.sup).upOutOf=this.sup,t.jQ=d('<span class="mq-sub"></span>').append(t.jQ.children()).attr(e,t.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>'));for(var n=0;n<2;n+=1)!function(t,e,n,i){t[e].deleteOutOf=function(r,s){if(s.insDirOf(this[r]?-r:r,this.parent),!this.isEmpty()){var o=this.ends[r];this.children().disown().withDirAdopt(r,s.parent,s[r],s[-r]).jQ.insDirOf(-r,s.jQ),s[-r]=o}t.supsub=n,delete t[e],delete t[i+"Into"],t[n][i+"OutOf"]=xt,delete t[n].deleteOutOf,"sub"===e&&d(t.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}}(this,"sub sup".split(" ")[n],"sup sub".split(" ")[n],"down up".split(" ")[n])},t.reflow=function(){var t=this.jQ,e=t.prev();if(e.length){var n=t.children(".mq-sup");if(n.length){var i=parseInt(n.css("font-size")),r=n.offset().top+n.height()-e.offset().top-.7*i,s=parseInt(n.css("margin-bottom"));n.css("margin-bottom",s+r)}}}}));function xt(t){var e=this.parent,n=t;do{if(n[1])return t.insLeftOf(e);n=n.parent.parent}while(n!==e);t.insRightOf(e)}w.subscript=w._=u(wt,(function(t,e){t.supsub="sub",t.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["_"],t.finalizeTree=function(){this.downInto=this.sub=this.ends[f],this.sub.upOutOf=xt,e.finalizeTree.call(this)}})),w.superscript=w.supscript=w["^"]=u(wt,(function(t,e){t.supsub="sup",t.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',t.textTemplate=["^"],t.finalizeTree=function(){this.upInto=this.sup=this.ends[1],this.sup.downOutOf=xt,e.finalizeTree.call(this)}}));var qt=u(F,(function(t,e){t.init=function(t,e){var n='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+e+'</big><span class="mq-from"><span>&0</span></span></span>';N.prototype.init.call(this,t,n)},t.createLeftOf=function(t){e.createLeftOf.apply(this,arguments),t.options.sumStartsWithNEquals&&(tt("n").createLeftOf(t),ft().createLeftOf(t))},t.latex=function(){function t(t){return 1===t.length?t:"{"+(t||" ")+"}"}return this.ctrlSeq+"_"+t(this.ends[f].latex())+"^"+t(this.ends[1].latex())},t.parser=function(){for(var t=P.string,e=P.optWhitespace,n=P.succeed,i=M.block,r=this,s=r.blocks=[K(),K()],o=0;o<s.length;o+=1)s[o].adopt(r,r.ends[1],0);return e.then(t("_").or(t("^"))).then((function(t){var e=s["_"===t?0:1];return i.then((function(t){return t.children().adopt(e,e.ends[1],0),n(r)}))})).many().result(r)},t.finalizeTree=function(){this.downInto=this.ends[f],this.upInto=this.ends[1],this.ends[f].upOutOf=this.ends[1],this.ends[1].downOutOf=this.ends[f]}}));w["∑"]=w.sum=w.summation=c(qt,"\\sum ","&sum;"),w["∏"]=w.prod=w.product=c(qt,"\\prod ","&prod;"),w.coprod=w.coproduct=c(qt,"\\coprod ","&#8720;"),w["∫"]=w.int=w.integral=u(qt,(function(t,e){t.init=function(){N.prototype.init.call(this,"\\int ",'<span class="mq-int mq-non-leaf"><big>&int;</big><span class="mq-supsub mq-non-leaf"><span class="mq-sup"><span class="mq-sup-inner">&1</span></span><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203</span></span></span>')},t.createLeftOf=F.p.createLeftOf}));var yt=w.frac=w.dfrac=w.cfrac=w.fraction=u(F,(function(t,e){t.ctrlSeq="\\frac",t.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["(",")/(",")"],t.finalizeTree=function(){this.upInto=this.ends[1].upOutOf=this.ends[f],this.downInto=this.ends[f].downOutOf=this.ends[1]}})),Ot=w.over=x["/"]=u(yt,(function(t,e){t.createLeftOf=function(t){if(!this.replacedFragment){for(var n=t[f];n&&!(n instanceof V||n instanceof(w.text||r)||n instanceof qt||"\\ "===n.ctrlSeq||/^[,;:]$/.test(n.ctrlSeq));)n=n[f];n instanceof qt&&n[1]instanceof wt&&(n=n[1])[1]instanceof wt&&n[1].ctrlSeq!=n.ctrlSeq&&(n=n[1]),n===t[f]||t.isTooDeep(1)||(this.replaces(b(n[1]||t.parent.ends[f],t[f])),t[f]=n)}e.createLeftOf.call(this,t)}})),kt=w.sqrt=w["√"]=u(F,(function(t,e){t.ctrlSeq="\\sqrt",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',t.textTemplate=["sqrt(",")"],t.parser=function(){return M.optBlock.then((function(t){return M.block.map((function(e){var n=Ct();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n}))})).or(e.parser.call(this))},t.reflow=function(){var t=this.ends[1].jQ;pt(t.prev(),1,t.innerHeight()/+t.css("fontSize").slice(0,-2)-.1)}})),Ct=(w.hat=u(F,(function(t,e){t.ctrlSeq="\\hat",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-hat-prefix">^</span><span class="mq-hat-stem">&0</span></span>',t.textTemplate=["hat(",")"]})),w.root=w.nthroot=u(kt,(function(t,e){t.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',t.textTemplate=["sqrt[","](",")"],t.latex=function(){return"\\sqrt["+this.ends[f].latex()+"]{"+this.ends[1].latex()+"}"}}))),jt=u(F,(function(t,e){t.init=function(t,n,i){var r='<span class="mq-non-leaf"><span class="mq-diacritic-above">'+n+'</span><span class="mq-diacritic-stem">&0</span></span>';e.init.call(this,t,r,i)}}));function Qt(t,e){t.jQadd=function(){e.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},t.reflow=function(){var t=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));pt(this.delimjQs,n(1+.2*(t-1),1.2),1.2*t)}}w.vec=c(jt,"\\vec","&rarr;",["vec(",")"]),w.tilde=c(jt,"\\tilde","~",["tilde(",")"]);var Tt=u(u(F,Qt),(function(t,e){t.init=function(t,n,i,r,s){e.init.call(this,"\\left"+r,void 0,[n,i]),this.side=t,this.sides={},this.sides[f]={ch:n,ctrlSeq:r},this.sides[1]={ch:i,ctrlSeq:s}},t.numBlocks=function(){return 1},t.html=function(){return this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-paren'+(1===this.side?" mq-ghost":"")+'">'+this.sides[f].ch+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren'+(this.side===f?" mq-ghost":"")+'">'+this.sides[1].ch+"</span></span>",e.html.call(this)},t.latex=function(){return"\\left"+this.sides[f].ctrlSeq+this.ends[f].latex()+"\\right"+this.sides[1].ctrlSeq},t.matchBrack=function(t,e,n){return n instanceof Tt&&n.side&&n.side!==-e&&(!t.restrictMismatchedBrackets||St[this.sides[this.side].ch]===n.sides[n.side].ch||{"(":"]","[":")"}[this.sides[f].ch]===n.sides[1].ch)&&n},t.closeOpposing=function(t){t.side=0,t.sides[this.side]=this.sides[this.side],t.delimjQs.eq(this.side===f?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},t.createLeftOf=function(t){if(!this.replacedFragment){var n=t.options;if("|"===this.sides[f].ch)var i=this.matchBrack(n,1,t[1])||this.matchBrack(n,f,t[f])||this.matchBrack(n,0,t.parent.parent);else i=this.matchBrack(n,-this.side,t[-this.side])||this.matchBrack(n,-this.side,t.parent.parent)}if(i){var r=this.side=-i.side;this.closeOpposing(i),i===t.parent.parent&&t[r]&&b(t[r],t.parent.ends[r],-r).disown().withDirAdopt(-r,i.parent,i,i[r]).jQ.insDirOf(r,i.jQ),i.bubble("reflow")}else r=(i=this).side,i.replacedFragment?i.side=0:t[-r]&&(i.replaces(b(t[-r],t.parent.ends[-r],r)),t[-r]=0),e.createLeftOf.call(i,t);r===f?t.insAtLeftEnd(i.ends[f]):t.insRightOf(i)},t.placeCursor=r,t.unwrap=function(){this.ends[f].children().disown().adopt(this.parent,this,this[1]).jQ.insertAfter(this.jQ),this.remove()},t.deleteSide=function(t,e,n){var i=this.parent,r=this[t],s=i.ends[t];if(t===this.side)return this.unwrap(),void(r?n.insDirOf(-t,r):n.insAtDirEnd(t,i));var o=n.options,a=!this.side;if(this.side=-t,this.matchBrack(o,t,this.ends[f].ends[this.side])){this.closeOpposing(this.ends[f].ends[this.side]);var l=this.ends[f].ends[t];this.unwrap(),l.siblingCreated&&l.siblingCreated(n.options,t),r?n.insDirOf(-t,r):n.insAtDirEnd(t,i)}else{if(this.matchBrack(o,t,this.parent.parent))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(e&&a)return this.unwrap(),void(r?n.insDirOf(-t,r):n.insAtDirEnd(t,i));this.sides[t]={ch:St[this.sides[this.side].ch],ctrlSeq:St[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(t===f?0:1).addClass("mq-ghost").html(this.sides[t].ch)}if(r){l=this.ends[f].ends[t];b(r,s,-t).disown().withDirAdopt(-t,this.ends[f],l,0).jQ.insAtDirEnd(t,this.ends[f].jQ.removeClass("mq-empty")),l.siblingCreated&&l.siblingCreated(n.options,t),n.insDirOf(-t,r)}else e?n.insDirOf(t,this):n.insAtDirEnd(t,this.ends[f])}},t.deleteTowards=function(t,e){this.deleteSide(-t,!1,e)},t.finalizeTree=function(){this.ends[f].deleteOutOf=function(t,e){this.parent.deleteSide(t,!0,e)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===f?1:0).removeClass("mq-ghost"),this.side=0}},t.siblingCreated=function(t,e){e===-this.side&&this.finalizeTree()}})),St={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|","\\lVert ":"\\rVert ","\\rVert ":"\\lVert "};function Dt(t,e){e=e||t;var n=St[t],i=St[e];x[t]=c(Tt,f,t,n,e,i),x[n]=c(Tt,1,t,n,e,i)}Dt("("),Dt("["),Dt("{","\\{"),w.langle=c(Tt,f,"&lang;","&rang;","\\langle ","\\rangle "),w.rangle=c(Tt,1,"&lang;","&rang;","\\langle ","\\rangle "),x["|"]=c(Tt,f,"|","|","|","|"),w.lVert=c(Tt,f,"&#8741;","&#8741;","\\lVert ","\\rVert "),w.rVert=c(Tt,1,"&#8741;","&#8741;","\\lVert ","\\rVert "),w.left=u(F,(function(t){t.parser=function(){var t=P.regex,e=P.string,n=(P.succeed,P.optWhitespace);return n.then(t(/^(?:[([|]|\\\{|\\langle(?![a-zA-Z])|\\lVert(?![a-zA-Z]))/)).then((function(i){var r="\\"===i.charAt(0)?i.slice(1):i;return"\\langle"==i&&(r="&lang;",i+=" "),"\\lVert"==i&&(r="&#8741;",i+=" "),M.then((function(s){return e("\\right").skip(n).then(t(/^(?:[\])|]|\\\}|\\rangle(?![a-zA-Z])|\\rVert(?![a-zA-Z]))/)).map((function(t){var e="\\"===t.charAt(0)?t.slice(1):t;"\\rangle"==t&&(e="&rang;",t+=" "),"\\rVert"==t&&(e="&#8741;",t+=" ");var n=Tt(0,r,e,i,t);return n.blocks=[s],s.adopt(n,0,0),n}))}))}))}})),w.right=u(F,(function(t){t.parser=function(){return P.fail("unmatched \\right")}}));var _t=w.binom=w.binomial=u(u(F,Qt),(function(t,e){t.ctrlSeq="\\binom",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',t.textTemplate=["choose(",",",")"]}));w.choose=u(_t,(function(t){t.createLeftOf=Ot.prototype.createLeftOf}));w.editable=w.MathQuillMathField=u(F,(function(t,e){t.ctrlSeq="\\MathQuillMathField",t.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>',t.parser=function(){var t=this,n=P.string,i=P.regex,r=P.succeed;return n("[").then(i(/^[a-z][a-z0-9]*/i)).skip(n("]")).map((function(e){t.name=e})).or(r()).then(e.parser.call(t))},t.finalizeTree=function(t){var e=O(this.ends[f],this.jQ,t);e.KIND_OF_MQ="MathField",e.editable=!0,e.createTextarea(),e.editablesTextareaEvents(),e.cursor.insAtRightEnd(e.root),z(e.root)},t.registerInnerField=function(t,e){t.push(t[this.name]=e(this.ends[f].controller))},t.latex=function(){return this.ends[f].latex()},t.text=function(){return this.ends[f].text()}}));var Et=w.embed=u(N,(function(t,e){t.setOptions=function(t){function e(){return""}return this.text=t.text||e,this.htmlTemplate=t.htmlString||"",this.latex=t.latex||e,this},t.parser=function(){var t=this,e=P.string,n=P.regex,i=P.succeed;return e("{").then(n(/^[a-z][a-z0-9]*/i)).skip(e("}")).then((function(r){return e("[").then(n(/^[-\w\s]*/)).skip(e("]")).or(i()).map((function(e){return t.setOptions(T[r](e))}))}))}})),At={};w.begin=u(F,(function(t,e){t.parser=function(){var t=P.string,e=P.regex;return t("{").then(e(/^[a-z]+/i)).skip(t("}")).then((function(e){return(At[e]?At[e]().parser():P.fail("unknown environment type: "+e)).skip(t("\\end{"+e+"}"))}))}}));var Lt=u(F,(function(t,e){t.template=[["\\begin{","}"],["\\end{","}"]],t.wrappers=function(){return[t.template[0].join(this.environment),t.template[1].join(this.environment)]}})),zt=At.matrix=u(Lt,(function(t,i){var r="&",s="\\\\";t.parentheses={left:null,right:null},t.environment="matrix",t.reflow=function(){var t=this.jQ.children("table"),e=t.outerHeight()/+t.css("fontSize").slice(0,-2),i=this.jQ.children(".mq-paren");i.length&&pt(i,n(1+.2*(e-1),1.2),1.05*e)},t.latex=function(){var t,e="";return this.eachChild((function(n){void 0!==t&&(e+=t!==n.row?s:r),t=n.row,e+=n.latex()})),this.wrappers().join(e)},t.html=function(){var t,e=[],n="",r=0;function s(t){return t?'<span class="mq-scaled mq-paren">'+t+"</span>":""}return this.eachChild((function(i){t!==i.row&&(t=i.row,n+="<tr>$tds</tr>",e[t]=[]),e[t].push("<td>&"+r+++"</td>")})),this.htmlTemplate='<span class="mq-matrix mq-non-leaf">'+s(this.parentheses.left)+'<table class="mq-non-leaf">'+n.replace(/\$tds/g,(function(){return e.shift().join("")}))+"</table>"+s(this.parentheses.right)+"</span>",i.html.call(this)},t.createBlocks=function(){this.blocks=[Rt(0,this),Rt(0,this),Rt(1,this),Rt(1,this)]},t.parser=function(){var t=this,e=P.optWhitespace,n=P.string;return e.then(n(r).or(n(s)).or(M.block)).many().skip(e).then((function(e){var n=[],i=0;function r(){t.blocks.push(Rt(i,t,n)),n=[]}t.blocks=[];for(var o=0;o<e.length;o+=1)e[o]instanceof K?n.push(e[o]):(r(),e[o]===s&&(i+=1));return r(),t.autocorrect(),P.succeed(t)}))},t.finalizeTree=function(){var t=this.jQ.find("table");t.toggleClass("mq-rows-1",1===t.find("tr").length),this.relink()},t.getEntryPoint=function(t,e,n){return"up"===n?t===f?this.blocks[this.rowSize-1]:this.blocks[0]:t===f?this.blocks[this.blocks.length-1]:this.blocks[this.blocks.length-this.rowSize]},t.atExitPoint=function(t,e){var n=this.blocks.indexOf(e.parent);return t===f?n%this.rowSize==0:(n+1)%this.rowSize==0},t.moveTowards=function(t,e,n){var i=n&&this.getEntryPoint(t,e,n);e.insAtDirEnd(-t,i||this.ends[-t])},t.relink=function(){var t,e,n,i=this.blocks,r=[];this.rowSize=i.length;for(var s=0;s<i.length;s+=1)t!==(n=i[s]).row&&(1===n.row&&(this.rowSize=e),r[t=n.row]=[],e=0),r[t][e]=n,n[1]=i[s+1],n[f]=i[s-1],r[t-1]&&r[t-1][e]&&(n.upOutOf=r[t-1][e],r[t-1][e].downOutOf=n),e+=1;this.ends[f]=i[0],this.ends[1]=i[i.length-1]},t.autocorrect=function(t){var e,n,i,r,s,o=[],a=(t=[],this.blocks);for(s=0;s<a.length;s+=1)t[r=a[s].row]=t[r]||[],t[r].push(a[s]),o[r]=t[r].length;if((e=Math.max.apply(null,o))!==Math.min.apply(null,o)){for(s=0;s<t.length;s+=1)for(n=e-t[s].length;n;)i=e*s+t[s].length,a.splice(i,0,Rt(s,this)),n-=1;this.relink()}},t.deleteCell=function(t){var e,n,i=[],r=[],s=[],o=[],a=this.blocks;function l(t){for(var e=[],n=0;n<t.length;n+=1)t[n].isEmpty()&&e.push(t[n]);return e.length===t.length}function c(t){for(var e=0;e<t.length;e+=1)a.indexOf(t[e])>-1&&(t[e].remove(),a.splice(a.indexOf(t[e]),1))}this.eachChild((function(a){e!==a.row&&(e=a.row,i[e]=[],n=0),r[n]=r[n]||[],r[n].push(a),i[e].push(a),a===t&&(s=i[e],o=r[n]),n+=1})),l(s)&&o.length>1&&(e=i.indexOf(s),this.eachChild((function(t){t.row>e&&(t.row-=1)})),c(s),this.jQ.find("tr").eq(e).remove()),l(o)&&s.length>1&&c(o),this.finalizeTree()},t.deleteRow=function(t){var e,n,i=[],r=[],s=[],o=[],a=this.blocks;this.eachChild((function(a){e!==a.row&&(e=a.row,i[e]=[],n=0),r[n]=r[n]||[],r[n].push(a),i[e].push(a),a===t&&(s=i[e],o=r[n]),n+=1})),o.length>1&&(e=i.indexOf(s),this.eachChild((function(t){t.row>e&&(t.row-=1)})),function(t){for(var e=0;e<t.length;e+=1)a.indexOf(t[e])>-1&&(t[e].remove(),a.splice(a.indexOf(t[e]),1))}(s),this.jQ.find("tr").eq(e).remove()),this.finalizeTree()},t.deleteColumn=function(t){var e,n,i=[],r=[],s=[],o=[],a=this.blocks;this.eachChild((function(a){e!==a.row&&(e=a.row,i[e]=[],n=0),r[n]=r[n]||[],r[n].push(a),i[e].push(a),a===t&&(s=i[e],o=r[n]),n+=1})),s.length>1&&function(t){for(var e=0;e<t.length;e+=1)a.indexOf(t[e])>-1&&(t[e].remove(),a.splice(a.indexOf(t[e]),1))}(o),this.finalizeTree()},t.addRow=function(t){var n,i,r=[],s=[],o=[],a=d("<tr></tr>"),l=t.row,c=0;this.eachChild((function(e){e.row<=l&&r.push(e),e.row===l&&(e===t&&(i=c),c+=1),e.row>l&&(e.row+=1,o.push(e))}));for(var h=0;h<c;h+=1)(n=Rt(l+1)).parent=this,s.push(n),n.jQ=d('<td class="mq-empty">').attr(e,n.id).appendTo(a);return this.jQ.find("tr").eq(l).after(a),this.blocks=r.concat(s,o),s[i]},t.addColumn=function(t){var n,i,r=[],s=[];this.eachChild((function(e){r[e.row]=r[e.row]||[],r[e.row].push(e),e===t&&(n=r[e.row].length)}));for(var o=0;o<r.length;o+=1)(i=Rt(o)).parent=this,s.push(i),r[o].splice(n,0,i),i.jQ=d('<td class="mq-empty">').attr(e,i.id);return this.jQ.find("tr").each((function(t){d(this).find("td").eq(n-1).after(r[t][n].jQ)})),this.blocks=[].concat.apply([],r),s[t.row]},t.insert=function(t,e){var n=this[t](e);this.cursor=this.cursor||this.parent.cursor,this.finalizeTree(),this.bubble("reflow").cursor.insAtRightEnd(n)},t.remove=function(t,e){this[t](e);this.cursor=this.cursor||this.parent.cursor,this.finalizeTree(),this.bubble("reflow")},t.backspace=function(t,e,n,i){var r=t[e];if(t.isEmpty()){for(this.deleteCell(t);r&&r[e]&&-1===this.blocks.indexOf(r);)r=r[e];r&&n.insAtDirEnd(-e,r),1===this.blocks.length&&this.blocks[0].isEmpty()&&(i(),this.finalizeTree()),this.bubble("edited")}}}));At.pmatrix=u(zt,(function(t,e){t.environment="pmatrix",t.parentheses={left:"(",right:")"}})),At.bmatrix=u(zt,(function(t,e){t.environment="bmatrix",t.parentheses={left:"[",right:"]"}})),At.Bmatrix=u(zt,(function(t,e){t.environment="Bmatrix",t.parentheses={left:"{",right:"}"}})),At.vmatrix=u(zt,(function(t,e){t.environment="vmatrix",t.parentheses={left:"|",right:"|"}})),At.Vmatrix=u(zt,(function(t,e){t.environment="Vmatrix",t.parentheses={left:"&#8214;",right:"&#8214;"}}));var Rt=u(K,(function(t,e){t.init=function(t,n,i){if(e.init.call(this),this.row=t,n&&this.adopt(n,n.ends[1],0),i)for(var r=0;r<i.length;r++)i[r].children().adopt(this,this.ends[1],0)},t.keystroke=function(t,n,i){switch(t){case"Shift-Spacebar":return n.preventDefault(),this.parent.insert("addColumn",this);case"Shift-Enter":return this.parent.insert("addRow",this)}return e.keystroke.apply(this,arguments)},t.deleteOutOf=function(t,n){var i=this,r=arguments;this.parent.backspace(this,t,n,(function(){return e.deleteOutOf.apply(i,r)}))},t.moveOutOf=function(t,e,n){!(n&&this.parent.atExitPoint(t,e))&&this[t]?e.insAtDirEnd(-t,this[t]):e.insDirOf(t,this.parent)}}));x["\\"]=u(F,(function(t,e){t.ctrlSeq="\\",t.replaces=function(t){this._replacedFragment=t.disown(),this.isEmpty=function(){return!1}},t.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',t.textTemplate=["\\"],t.createBlocks=function(){e.createBlocks.call(this),this.ends[f].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[f].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[f].write=function(t,e){t.show().deleteSelection(),e.match(/[a-z]/i)?$(e).createLeftOf(t):(this.parent.renderCommand(t),"\\"===e&&this.isEmpty()||t.parent.write(t,e))},this.ends[f].keystroke=function(t,n,i){return"Tab"===t||"Enter"===t||"Spacebar"===t?(this.parent.renderCommand(i.cursor),void n.preventDefault()):e.keystroke.apply(this,arguments)}},t.createLeftOf=function(t){if(e.createLeftOf.call(this,t),this._replacedFragment){var n=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",(function(t){return d(t.target=n).trigger(t),!1})).insertBefore(this.jQ).add(this.jQ)}},t.latex=function(){return"\\"+this.ends[f].latex()+" "},t.renderCommand=function(t){this.jQ=this.jQ.last(),this.remove(),this[1]?t.insLeftOf(this[1]):t.insAtRightEnd(this.parent);var e=this.ends[f].latex();e||(e=" ");var n=w[e]||At[e];n?(n=n(e),this._replacedFragment&&n.replaces(this._replacedFragment),n.createLeftOf(t)):((n=W()).replaces(e),n.createLeftOf(t),t.insRightOf(n),this._replacedFragment&&this._replacedFragment.remove())}}));j.addCommands=function(t){for(var e in t){if(w.hasOwnProperty(e))throw'"'+e+'" is a built-in operator name';if(3!=t[e].length)throw'"'+e+'" does not have the required number of elements';if("VanillaSymbol"==t[e][0])w[e]=c($,t[e][1],t[e][2]);else if("BinaryOperator"==t[e][0])w[e]=c(V,t[e][1],t[e][2]);else{if("Variable"!=t[e][0])throw'"'+e+'" is using an unsupported symbol type';w[e]=c(J,t[e][1],t[e][2])}}};var It=A(1);for(var Pt in It)!function(t,e){"function"==typeof e?(D[t]=function(){return S(),e.apply(this,arguments)},D[t].prototype=e.prototype):D[t]=e}(Pt,It[Pt])}();